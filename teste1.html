<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SFH ‚Äì Financiamento Pr√≥prio P√≥s-Obra (SBPE)</title>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #f4f6f5;
      color: #222;
    }

    /* ===== TOPO ===== */
    .painel-topo {
      background: #fff;
      border-bottom: 1px solid #e0e0e0;
      padding: 16px;
    }
    .painel-topo h1 {
      text-align: center;
      color: #1e3a8a;
      margin: 0 0 8px;
      font-size: 22px;
    }
    .painel-topo p {
      text-align: center;
      margin: 0;
      font-size: 13px;
      color: #444;
    }

    .grid-topo {
      max-width: 980px;
      margin: 16px auto 0;
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 768px) {
      .grid-topo { grid-template-columns: repeat(2, 1fr); }
    }

    .campo label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .campo input, .campo select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 15px;
      background: #fff;
    }
    .campo-full { grid-column: 1 / -1; }

    /* ===== CONTAINER ===== */
    .container {
      max-width: 980px;
      margin: 24px auto;
      padding: 0 16px 40px;
    }

    /* ===== BLOCOS ===== */
    .bloco {
      background: #fff;
      border-radius: 14px;
      border: 1px solid #ddd;
      overflow: hidden;
      margin-bottom: 14px;
    }
    .bloco-header {
      color: #fff;
      padding: 14px 16px;
      font-weight: 800;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-entrada { background: #1e3a8a; }
    .header-pdf { background: #2563eb; }

    .toggle-icon {
      background: rgba(255,255,255,.18);
      border-radius: 6px;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
    }

    .bloco-conteudo {
      display: none;
      padding: 18px;
    }

    .subgrid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 768px) {
      .subgrid { grid-template-columns: repeat(2, 1fr); }
      .span2 { grid-column: 1 / -1; }
    }

    .divider {
      height: 1px;
      background: #e9e9e9;
      margin: 16px 0;
    }

    /* ===== CAIXAS ===== */
    .box-claro {
      background: #f6f9f7;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #e6efe9;
    }

    /* ===== BOT√ïES ===== */
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      color: #fff;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      margin-top: 12px;
    }
    .btn-entrada { background: #1e3a8a; }
    .btn-pdf { background: #2563eb; }
    .btn-limpar {
      background: #c62828;
      margin-top: 14px;
      text-transform: uppercase;
      letter-spacing: .4px;
    }

    @media (min-width: 768px) {
      button {
        width: 50%;
        margin-left: auto;
        margin-right: auto;
        display: block;
      }
    }

    /* ===== RESULTADO ===== */
    .resultado {
      display: none;
      padding: 16px;
      border-radius: 12px;
      margin: 12px 0 14px;
      border: 1px solid rgba(0,0,0,.08);
    }
    .resultado.verde { background: #eaf7ee; border-color: #bfe6c9; }
    .resultado.amarelo { background: #fff7da; border-color: #f0dc8a; }
    .resultado.vermelho { background: #ffe3e3; border-color: #ffb7b7; }

    .alerta { color: #8b1e1e; font-weight: 900; }
    .obs { font-size: 13px; font-style: italic; margin-top: 10px; }
  </style>
</head>

<body>

<!-- =========================
     CABE√áALHO
========================== -->
<div class="painel-topo">
  <h1>SFH ‚Äì Financiamento Pr√≥prio P√≥s-Obra (SBPE)</h1>
  <p>Simula√ß√£o para im√≥veis com financiamento contratado ap√≥s a conclus√£o do empreendimento.</p>

  <div class="grid-topo">
    <div class="campo">
      <label>üè¢ Empreendimento</label>
      <input id="empreendimento" />
    </div>

    <div class="campo">
      <label>üè† Unidade / Bloco / Andar</label>
      <input id="unidade" />
    </div>

    <div class="campo">
      <label>üè† Valor do Im√≥vel (R$)</label>
      <input id="valorImovel" oninput="formatarMoeda(this)" />
    </div>

    <div class="campo">
      <label>üè¶ Valor Previsto para Financiamento (R$)</label>
      <input id="valorFinanciamento" oninput="formatarMoeda(this)" />
    </div>

    <div class="campo campo-full">
      <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
      <input id="renda" oninput="formatarMoeda(this)" />
    </div>
  </div>
</div>

<div class="container">

<!-- =========================
     ENTRADA / FLUXO
========================== -->
<div class="bloco">
  <div class="bloco-header header-entrada" onclick="toggleBloco(this)">
    <span>üí∞ Entrada / Fluxo Inicial</span>
    <span class="toggle-icon">+</span>
  </div>

  <div class="bloco-conteudo">
    <div class="subgrid">
      <div class="campo">
        <label>üí∏ Valor do Ato (R$)</label>
        <input id="ato" oninput="formatarMoeda(this)" />
      </div>

      <div class="campo">
        <label>üóìÔ∏è Meses / Parcelas</label>
        <input id="parcelasEntrada" type="number" min="1" />
      </div>
    </div>

    <button class="btn-entrada" onclick="calcularEntrada()">Calcular Entrada</button>
  </div>
</div>

<div id="resultadoEntrada" class="resultado"></div>

<!-- =========================
     PDF
========================== -->
<div class="bloco">
  <div class="bloco-header header-pdf" onclick="toggleBloco(this)">
    <span>üìÑ Gerar PDF</span>
    <span class="toggle-icon">+</span>
  </div>

  <div class="bloco-conteudo">
    <div class="subgrid">
      <div class="campo">
        <label>üë§ Cliente</label>
        <input id="pdfCliente" />
      </div>

      <div class="campo">
        <label>üßë‚Äçüíº Corretor</label>
        <input id="pdfCorretor" />
      </div>
    </div>

    <button class="btn-pdf" onclick="gerarPDF()">Gerar PDF da Simula√ß√£o</button>
  </div>
</div>

</div>

<script>
/* =========================
   UTIL
========================= */
function formatarMoeda(c){
  let v = (c.value || "").replace(/\D/g, "");
  if(!v){ c.value = ""; return; }
  v = (parseInt(v,10) / 100).toFixed(2).replace(".", ",");
  v = v.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  c.value = "R$ " + v;
}
function limparMoeda(v){
  return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", ".")) || 0;
}
function moeda(n){
  return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

/* =========================
   UI
========================= */
function toggleBloco(el){
  const c = el.nextElementSibling;
  const i = el.querySelector(".toggle-icon");
  const aberto = c.style.display === "block";
  c.style.display = aberto ? "none" : "block";
  i.textContent = aberto ? "+" : "‚Äì";
}

/* =========================
   ENTRADA (IGUAL AO MCMV)
========================= */
function setResultadoEntrada(tipo, html){
  const out = document.getElementById("resultadoEntrada");
  out.className = "resultado " + tipo;
  out.innerHTML = html;
  out.style.display = "block";
}

function calcularEntrada(){
  const im = limparMoeda(valorImovel.value);
  const fi = limparMoeda(valorFinanciamento.value);
  const at = limparMoeda(ato.value);
  const re = limparMoeda(renda.value);
  const p  = parseInt(parcelasEntrada.value,10) || 0;

  if(!im || !fi || !re || !p){
    setResultadoEntrada("vermelho",
      `<h3>‚ö†Ô∏è Entrada / Fluxo Inicial</h3>
       <p class="alerta">Preencha todos os campos obrigat√≥rios.</p>
       <button class="btn-limpar" onclick="limparEntrada()">LIMPAR</button>`
    );
    return;
  }

  const entrada = im - fi;
  let saldo = entrada - at;
  const limiteMensal = re * 0.30;
  let mensal = saldo / p;
  let resto = 0;

  if(mensal > limiteMensal){
    mensal = limiteMensal;
    resto = saldo - (mensal * p);
  }

  if(resto <= 0){
    setResultadoEntrada("verde",
      `<h3>‚úÖ Fluxo de Entrada</h3>
       <p>Entrada total: <b>${moeda(entrada)}</b></p>
       <p>Ato: <b>${moeda(at)}</b></p>
       <p>Mensais (${p}x): <b>${moeda(mensal)}</b></p>
       <button class="btn-limpar" onclick="limparEntrada()">LIMPAR</button>`
    );
    return;
  }

  setResultadoEntrada("amarelo",
    `<h3>‚ö†Ô∏è Entrada com saldo restante</h3>
     <p>Entrada total: <b>${moeda(entrada)}</b></p>
     <p>Ato: <b>${moeda(at)}</b></p>
     <p>Mensais (${p}x): <b>${moeda(mensal)}</b></p>
     <p><b>Saldo restante:</b> ${moeda(resto)}</p>
     <div class="obs">Saldo a ser financiado ap√≥s a conclus√£o do empreendimento.</div>
     <button class="btn-limpar" onclick="limparEntrada()">LIMPAR</button>`
  );
}

function limparEntrada(){
  resultadoEntrada.style.display="none";
  resultadoEntrada.innerHTML="";
  resultadoEntrada.className="resultado";
}

/* =========================
   PDF
========================= */
async function gerarPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text("SFH ‚Äì Financiamento Pr√≥prio P√≥s-Obra (SBPE)", 14, 16);
  doc.text(`Cliente: ${pdfCliente.value || "-"}`, 14, 28);
  doc.text(`Corretor: ${pdfCorretor.value || "-"}`, 14, 36);
  doc.text(`Empreendimento: ${empreendimento.value || "-"}`, 14, 44);
  doc.text(`Valor do im√≥vel: ${valorImovel.value || "-"}`, 14, 52);
  doc.text(`Valor previsto para financiamento: ${valorFinanciamento.value || "-"}`, 14, 60);

  doc.text(
    "Observa√ß√£o: Simula√ß√£o baseada em financiamento p√≥s-obra. Valores estimados.",
    14,
    72
  );

  doc.save("simulacao-sbpe-pos-obra.pdf");
}
</script>

</body>
</html>
