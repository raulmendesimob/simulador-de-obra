<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora ‚Äî Faixa de Im√≥vel (Vida Real)</title>
<style>
  body{
    font-family:"Poppins",sans-serif;
    background:#eef7fb;
    margin:0;padding:0;
    display:flex;justify-content:center;align-items:flex-start;
    min-height:100vh;
  }
  .container{
    background:#fff;
    margin:20px;
    padding:25px;
    border-radius:15px;
    max-width:460px;
    width:100%;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  h2{ text-align:center;color:#003366;margin:0 0 8px; }
  p.sub{
    text-align:center;
    color:#3b4a5a;
    margin:0 0 18px;
    font-size:13px;
    line-height:1.35;
  }
  label{
    font-weight:600;color:#333;display:block;
    margin:10px 0 5px;
  }
  input, select{
    width:100%;
    padding:10px;
    font-size:15px;
    border-radius:8px;
    border:1px solid #ccc;
    margin-bottom:6px;
    box-sizing:border-box;
  }
  .row{
    display:flex; gap:10px;
  }
  .row > div{ flex:1; }

  .btn{
    width:100%;
    border:none;border-radius:10px;
    padding:12px;color:#fff;font-weight:bold;
    cursor:pointer;margin-top:10px;font-size:16px;transition:0.3s;
  }
  .btn-green{ background:#009b4d; }
  .btn-green:hover{ background:#00c060; }
  .btn-gray{ background:#ccc;color:#333; }
  .cards{
    margin-top:16px;
    display:grid;
    grid-template-columns:1fr;
    gap:10px;
  }
  .card{
    border-radius:12px;
    padding:12px;
    border:1px solid #e6eef6;
    background:#f9fcff;
  }
  .card h3{
    margin:0 0 6px;
    font-size:14px;
    color:#003366;
  }
  .big{
    font-size:22px;
    font-weight:800;
    color:#003366;
    margin:2px 0 8px;
  }
  .meta{
    font-size:13px;
    color:#2d3a46;
    line-height:1.35;
  }
  .tag{
    display:inline-block;
    font-size:12px;
    padding:4px 8px;
    border-radius:999px;
    font-weight:700;
    margin-top:8px;
  }
  .tag.ok{ background:#e5f8ea;color:#007b33; }
  .tag.mid{ background:#fff6db;color:#7a5b00; }
  .tag.max{ background:#ffe3e3;color:#8a1c1c; }

  .obs{
    margin-top:14px;
    background:#ffffff;
    border:1px dashed #c9d9ea;
    border-radius:12px;
    padding:12px 14px;
  }
  .obs h4{
    margin:0 0 8px;
    color:#003366;
    font-size:14px;
  }
  .obs ul{
    margin:0;
    padding-left:18px;
    color:#2d3a46;
    font-size:13px;
    line-height:1.45;
  }
  footer{
    text-align:center;
    font-size:14px;
    color:#555;
    margin-top:18px;
  }
  .social img{ width:22px;height:22px;vertical-align:middle; }
  .social a{
    text-decoration:none;color:#333;font-weight:500;margin-left:8px;
  }
</style>
</head>
<body>

<div class="container">
  <h2>Faixa de Im√≥vel (Vida Real)</h2>
  <p class="sub">
    Informe s√≥ o b√°sico e veja 3 cen√°rios: <b>Ideal</b>, <b>Pag√°vel</b> e <b>M√°ximo</b> (pico na obra).
  </p>

  <label>üí∞ Renda familiar mensal (R$):</label>
  <input type="text" id="renda" placeholder="Ex: 6000" inputmode="numeric" autocomplete="off">

  <div class="row">
    <div>
      <label>üè¶ FGTS utiliz√°vel (R$):</label>
      <input type="text" id="fgts" placeholder="Ex: 10000" inputmode="numeric" autocomplete="off">
    </div>
    <div>
      <label>üßæ Ato / Entrada √† vista (R$):</label>
      <input type="text" id="ato" placeholder="Ex: 15000" inputmode="numeric" autocomplete="off">
    </div>
  </div>

  <label>üèóÔ∏è Prazo de obra:</label>
  <select id="prazoSelect">
    <option value="" selected disabled>Selecione‚Ä¶</option>
    <option value="12">At√© 12 meses</option>
    <option value="24">Entre 12 e 24 meses</option>
    <option value="30">Mais de 24 meses</option>
  </select>

  <button class="btn btn-green" onclick="calcularFaixas()">Calcular minhas faixas</button>
  <button class="btn btn-gray" onclick="limpar()">Limpar</button>

  <div id="cards" class="cards" style="display:none;"></div>

  <div id="obs" class="obs" style="display:none;">
    <h4>Observa√ß√µes importantes</h4>
    <ul id="obsList"></ul>
  </div>

  <footer>
    <div class="social">
      <a href="https://www.instagram.com/raulmendes.imob" target="_blank" rel="noopener">
        <img src="https://cdn-icons-png.flaticon.com/512/1384/1384063.png" alt="Instagram">
        @raulmendes.imob
      </a>
    </div>
  </footer>
</div>

<script>
/** ========= Helpers ========= **/
function parseBRL(str){
  if(!str) return 0;
  const digits = String(str).replace(/\D/g,'');
  if(digits === '') return 0;
  return Number(digits) / 100;
}
function formatBRL(n){
  return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

/**
 * Formata enquanto digita em R$ 0.000,00
 * - mant√©m apenas d√≠gitos internamente
 * - simples e est√°vel para inputmode numeric
 */
function bindMoneyInput(el){
  el.addEventListener("input", () => {
    let v = el.value.replace(/\D/g,'');
    if(v === "") { el.value = ""; return; }
    // limita tamanho para evitar n√∫meros gigantes (opcional)
    if(v.length > 12) v = v.slice(0, 12);

    let num = (Number(v) / 100).toFixed(2);
    let [intPart, decPart] = num.split(".");
    intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    el.value = `R$ ${intPart},${decPart}`;
  });

  // ao focar, coloca cursor no fim (boa UX com m√°scara simples)
  el.addEventListener("focus", () => {
    const len = el.value.length;
    setTimeout(() => el.setSelectionRange(len, len), 0);
  });
}

bindMoneyInput(document.getElementById("renda"));
bindMoneyInput(document.getElementById("fgts"));
bindMoneyInput(document.getElementById("ato"));

function limpar(){
  ["renda","fgts","ato"].forEach(id => document.getElementById(id).value = "");
  document.getElementById("prazoSelect").value = "";

  document.getElementById("cards").style.display = "none";
  document.getElementById("cards").innerHTML = "";
  document.getElementById("obs").style.display = "none";
  document.getElementById("obsList").innerHTML = "";
}

/** ========= Modelo simplificado =========
 * Premissas internas (sem perguntar):
 * - Entrada-alvo: 20% do im√≥vel
 * - Financiamento: 80% do im√≥vel
 * - Juros anual de refer√™ncia (MCMV): 7.93% a.a.
 * - Prazo financiamento: 420 meses
 *
 * Pico na obra (aprox):
 * pico = entrada mensal + juros de obra (pico)
 *
 * Juros de obra (pico) aprox:
 * jurosObraPico = financiamento * (jurosAA/12) * fatorPicoLiberacao
 * fatorPicoLiberacao: perto do fim, grande parte do cr√©dito j√° foi liberada (~0.90)
 */
function calcularFaixas(){
  const renda = parseBRL(document.getElementById("renda").value);
  const fgts  = parseBRL(document.getElementById("fgts").value);
  const ato   = parseBRL(document.getElementById("ato").value);
  const prazoObra = Number(document.getElementById("prazoSelect").value);

  if(!renda || !prazoObra){
    alert("Preencha a renda e selecione o prazo de obra.");
    return;
  }

  const entradaImediata = fgts + ato;

  // Premissas fixas (pode ajustar depois no c√≥digo)
  const pctEntrada = 20;      // %
  const jurosAA = 7.93;       // % a.a.
  const prazoFin = 420;       // meses
  const fatorPicoLiberacao = 0.90;

  // Limites de pico (cen√°rios)
  const cenarios = [
    { nome:"Im√≥vel ideal",   pct:0.30, tagClass:"ok",  tagText:"Confort√°vel" },
    { nome:"Im√≥vel pag√°vel", pct:0.45, tagClass:"mid", tagText:"Vai apertar no fim" },
    { nome:"Im√≥vel m√°ximo",  pct:0.60, tagClass:"max", tagText:"No limite" }
  ];

  // Juros obra (pico) + entrada mensal estimada
  function picoEstimado(valorImovel){
    const entradaAlvo = valorImovel * (pctEntrada/100);
    const financiamento = Math.max(0, valorImovel - entradaAlvo);

    const entradaParcelavel = Math.max(0, entradaAlvo - entradaImediata);
    const parcelaEntradaMensal = entradaParcelavel / prazoObra;

    const jurosMensal = (jurosAA/100) / 12;
    const jurosObraPico = financiamento * jurosMensal * fatorPicoLiberacao;

    const pico = parcelaEntradaMensal + jurosObraPico;

    return { pico, financiamento, entradaAlvo, entradaParcelavel, parcelaEntradaMensal, jurosObraPico };
  }

  // Busca do maior valor do im√≥vel que respeita o limite de pico
  function encontrarMaxImovel(limitePico){
    let low = 80000;
    let high = 600000;

    if(picoEstimado(low).pico > limitePico){
      return { valor: low, ok:false, detalhe: picoEstimado(low) };
    }

    for(let i=0;i<42;i++){
      const mid = (low+high)/2;
      const det = picoEstimado(mid);
      if(det.pico <= limitePico) low = mid;
      else high = mid;
    }
    const valor = Math.floor(low/1000)*1000;
    return { valor, ok:true, detalhe: picoEstimado(valor) };
  }

  // Parcela do financiamento (PRICE) - sem seguros/adm (aprox)
  function parcelaPricePV(pv){
    const i = (jurosAA/100)/12;
    if(i <= 0) return pv/prazoFin;
    const fator = (i * Math.pow(1+i, prazoFin)) / (Math.pow(1+i, prazoFin)-1);
    return pv * fator;
  }

  const cardsEl = document.getElementById("cards");
  cardsEl.innerHTML = "";
  cardsEl.style.display = "grid";

  cenarios.forEach(c=>{
    const limitePico = renda * c.pct;
    const res = encontrarMaxImovel(limitePico);
    const v = res.valor;
    const d = res.detalhe;

    const parcelaFin = parcelaPricePV(d.financiamento);

    const pctRenda = (d.pico / renda) * 100;

    const html = `
      <div class="card">
        <h3>${c.nome}</h3>
        <div
