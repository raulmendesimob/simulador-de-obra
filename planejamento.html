<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora ‚Äî Faixa de Im√≥vel (Vida Real)</title>
<style>
  body{
    font-family:"Poppins",sans-serif;
    background:#eef7fb;
    margin:0;padding:0;
    display:flex;justify-content:center;align-items:flex-start;
    min-height:100vh;
  }
  .container{
    background:#fff;
    margin:20px;
    padding:25px;
    border-radius:15px;
    max-width:460px;
    width:100%;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  h2{ text-align:center;color:#003366;margin:0 0 8px; }
  p.sub{
    text-align:center;
    color:#3b4a5a;
    margin:0 0 18px;
    font-size:13px;
    line-height:1.35;
  }
  label{
    font-weight:600;color:#333;display:block;
    margin:10px 0 5px;
  }
  input, select{
    width:100%;
    padding:10px;
    font-size:15px;
    border-radius:8px;
    border:1px solid #ccc;
    margin-bottom:6px;
    box-sizing:border-box;
  }
  .row{
    display:flex; gap:10px;
  }
  .row > div{ flex:1; }

  .btn{
    width:100%;
    border:none;border-radius:10px;
    padding:12px;color:#fff;font-weight:bold;
    cursor:pointer;margin-top:10px;font-size:16px;transition:0.3s;
  }
  .btn-green{ background:#009b4d; }
  .btn-green:hover{ background:#00c060; }
  .btn-gray{ background:#ccc;color:#333; }
  .cards{
    margin-top:16px;
    display:grid;
    grid-template-columns:1fr;
    gap:10px;
  }
  .card{
    border-radius:12px;
    padding:12px;
    border:1px solid #e6eef6;
    background:#f9fcff;
  }
  .card h3{
    margin:0 0 6px;
    font-size:14px;
    color:#003366;
  }
  .big{
    font-size:22px;
    font-weight:800;
    color:#003366;
    margin:2px 0 8px;
  }
  .meta{
    font-size:13px;
    color:#2d3a46;
    line-height:1.35;
  }
  .tag{
    display:inline-block;
    font-size:12px;
    padding:4px 8px;
    border-radius:999px;
    font-weight:700;
    margin-top:8px;
  }
  .tag.ok{ background:#e5f8ea;color:#007b33; }
  .tag.mid{ background:#fff6db;color:#7a5b00; }
  .tag.max{ background:#ffe3e3;color:#8a1c1c; }

  .obs{
    margin-top:14px;
    background:#ffffff;
    border:1px dashed #c9d9ea;
    border-radius:12px;
    padding:12px 14px;
  }
  .obs h4{
    margin:0 0 8px;
    color:#003366;
    font-size:14px;
  }
  .obs ul{
    margin:0;
    padding-left:18px;
    color:#2d3a46;
    font-size:13px;
    line-height:1.45;
  }
  footer{
    text-align:center;
    font-size:14px;
    color:#555;
    margin-top:18px;
  }
  .social img{ width:22px;height:22px;vertical-align:middle; }
  .social a{
    text-decoration:none;color:#333;font-weight:500;margin-left:8px;
  }
</style>
</head>
<body>

<div class="container">
  <h2>Faixa de Im√≥vel (Vida Real)</h2>
  <p class="sub">
    Informe s√≥ o b√°sico e veja 3 cen√°rios: <b>Ideal</b>, <b>Pag√°vel</b> e <b>M√°ximo</b> (pico na obra).
  </p>

  <label>üí∞ Renda familiar mensal (R$):</label>
  <input type="text" id="renda" placeholder="Ex: 6000" inputmode="numeric" autocomplete="off">

  <div class="row">
    <div>
      <label>üè¶ FGTS utiliz√°vel (R$):</label>
      <input type="text" id="fgts" placeholder="Ex: 10000" inputmode="numeric" autocomplete="off">
    </div>
    <div>
      <label>üßæ Ato / Entrada √† vista (R$):</label>
      <input type="text" id="ato" placeholder="Ex: 15000" inputmode="numeric" autocomplete="off">
    </div>
  </div>

  <label>üèóÔ∏è Prazo de obra:</label>
  <select id="prazoSelect">
    <option value="" selected disabled>Selecione‚Ä¶</option>
    <option value="12">At√© 12 meses</option>
    <option value="24">Entre 12 e 24 meses</option>
    <option value="30">Mais de 24 meses</option>
  </select>

  <button class="btn btn-green" id="btnCalcular">Calcular minhas faixas</button>
  <button class="btn btn-gray" id="btnLimpar">Limpar</button>

  <div id="cards" class="cards" style="display:none;"></div>

  <div id="obs" class="obs" style="display:none;">
    <h4>Observa√ß√µes importantes</h4>
    <ul id="obsList"></ul>
  </div>

  <footer>
    <div class="social">
      <a href="https://www.instagram.com/raulmendes.imob" target="_blank" rel="noopener">
        <img src="https://cdn-icons-png.flaticon.com/512/1384/1384063.png" alt="Instagram">
        @raulmendes.imob
      </a>
    </div>
  </footer>
</div>

<script>
/** ========= Helpers ========= **/

// Formata BRL sem ‚Äúfor√ßar‚Äù centavos (mas o Intl sempre mostra 2 casas; ok)
function formatBRL(n){
  return Number(n || 0).toLocaleString("pt-BR", { style:"currency", currency:"BRL" });
}

// L√™ n√∫meros do input "R$ 6.000" -> 6000
function parseBRL(str){
  if(!str) return 0;
  const digits = String(str).replace(/\D/g,''); // pega s√≥ d√≠gitos
  if(digits === '') return 0;
  return Number(digits); // AGORA √â EM REAIS (sem /100)
}

// M√°scara em tempo real: digita 6000 => "R$ 6.000"
function bindMoneyInput(el){
  el.addEventListener("input", () => {
    let digits = el.value.replace(/\D/g,'');
    if(digits === "") { el.value = ""; return; }
    // limita pra n√£o virar um monstro
    if(digits.length > 12) digits = digits.slice(0, 12);

    const value = Number(digits); // reais
    // Formata com separador de milhar, sem decimal no texto (mais intuitivo)
    const formatted = value.toLocaleString("pt-BR", { maximumFractionDigits: 0 });
    el.value = "R$ " + formatted;
  });

  // cursor no fim (melhora UX)
  el.addEventListener("focus", () => {
    const len = el.value.length;
    setTimeout(() => el.setSelectionRange(len, len), 0);
  });
}

/** ========= C√°lculo ========= **/
function parcelaPricePV(pv, jurosAA, nMeses){
  const i = (jurosAA/100)/12;
  if(i <= 0) return pv/nMeses;
  const pow = Math.pow(1+i, nMeses);
  return pv * (i * pow) / (pow - 1);
}

function picoEstimado(valorImovel, entradaImediata, prazoObra, pctEntrada, jurosAA, fatorPicoLiberacao){
  const entradaAlvo = valorImovel * (pctEntrada/100);
  const financiamento = Math.max(0, valorImovel - entradaAlvo);

  const entradaParcelavel = Math.max(0, entradaAlvo - entradaImediata);
  const parcelaEntradaMensal = entradaParcelavel / prazoObra;

  const jurosMensal = (jurosAA/100) / 12;
  const jurosObraPico = financiamento * jurosMensal * fatorPicoLiberacao;

  const pico = parcelaEntradaMensal + jurosObraPico;

  return { pico, financiamento, entradaAlvo, entradaParcelavel, parcelaEntradaMensal, jurosObraPico };
}

function encontrarMaxImovel(limitePico, entradaImediata, prazoObra, pctEntrada, jurosAA, fatorPicoLiberacao){
  let low = 80000;
  let high = 600000;

  if(picoEstimado(low, entradaImediata, prazoObra, pctEntrada, jurosAA, fatorPicoLiberacao).pico > limitePico){
    const dMin = picoEstimado(low, entradaImediata, prazoObra, pctEntrada, jurosAA, fatorPicoLiberacao);
    return { valor: low, ok:false, detalhe: dMin };
  }

  for(let i=0;i<42;i++){
    const mid = (low+high)/2;
    const det = picoEstimado(mid, entradaImediata, prazoObra, pctEntrada, jurosAA, fatorPicoLiberacao);
    if(det.pico <= limitePico) low = mid;
    else high = mid;
  }

  const valor = Math.floor(low/1000)*1000;
  const detFinal = picoEstimado(valor, entradaImediata, prazoObra, pctEntrada, jurosAA, fatorPicoLiberacao);
  return { valor, ok:true, detalhe: detFinal };
}

function calcularFaixas(){
  const renda = parseBRL(document.getElementById("renda").value);
  const fgts  = parseBRL(document.getElementById("fgts").value);
  const ato   = parseBRL(document.getElementById("ato").value);
  const prazoObra = Number(document.getElementById("prazoSelect").value);

  if(!renda || renda <= 0){
    alert("Preencha a renda (ex: 6000).");
    return;
  }
  if(!prazoObra){
    alert("Selecione o prazo de obra.");
    return;
  }

  const entradaImediata = (fgts || 0) + (ato || 0);

  // Premissas fixas (sem perguntar)
  const pctEntrada = 20;          // Entrada-alvo (%)
  const jurosAA = 7.93;           // Juros anual refer√™ncia
  const prazoFin = 420;           // Meses
  const fatorPicoLiberacao = 0.90;

  const cenarios = [
    { nome:"Im√≥vel ideal",   pct:0.30, tagClass:"ok",  tagText:"Confort√°vel" },
    { nome:"Im√≥vel pag√°vel", pct:0.45, tagClass:"mid", tagText:"Vai apertar no fim" },
    { nome:"Im√≥vel m√°ximo",  pct:0.60, tagClass:"max", tagText:"No limite" }
  ];

  const cardsEl = document.getElementById("cards");
  cardsEl.innerHTML = "";
  cardsEl.style.display = "grid";

  cenarios.forEach(c=>{
    const limitePico = renda * c.pct;

    const res = encontrarMaxImovel(
      limitePico,
      entradaImediata,
      prazoObra,
      pctEntrada,
      jurosAA,
      fatorPicoLiberacao
    );

    const v = res.valor;
    const d = res.detalhe;

    const parcelaFin = parcelaPricePV(d.financiamento, jurosAA, prazoFin);
    const pctRenda = (d.pico / renda) * 100;

    const html = `
      <div class="card">
        <h3>${c.nome}</h3>
        <div class="big">${formatBRL(v)}</div>

        <div class="meta">
          <div style="margin-bottom:8px;">
            <b>Financiamento estimado:</b> ${formatBRL(d.financiamento)}<br>
            <b>Parcela do financiamento (aprox.):</b> ${formatBRL(parcelaFin)} / m√™s
          </div>

          <div style="margin-bottom:8px;">
            <b>Entrada-alvo (20%):</b> ${formatBRL(d.entradaAlvo)}<br>
            <b>Entrada imediata (FGTS + ato):</b> ${formatBRL(entradaImediata)}<br>
            <b>Entrada mensal estimada:</b> ${formatBRL(d.parcelaEntradaMensal)} por ${prazoObra} meses
          </div>

          <div>
            <b>Pico estimado na obra:</b> ${formatBRL(d.pico)}
            <span style="color:#566; font-weight:700;">(~${pctRenda.toFixed(1)}% da renda)</span><br>
            <span style="font-size:12px;color:#667;">
              (pico = entrada mensal + juros de obra aproximado)
            </span>
          </div>

          <span class="tag ${c.tagClass}">${c.tagText}</span>
        </div>
      </div>
    `;
    cardsEl.insertAdjacentHTML("beforeend", html);
  });

  // Bullets p√≥s-resultado
  const obs = [
    "Este resultado mostra cen√°rios e faixas prov√°veis ‚Äî n√£o √© proposta do banco.",
    "Prazo de obra muda tudo: quanto menor o prazo, maior tende a ser a entrada mensal.",
    "Juros de obra variam por evolu√ß√£o/medi√ß√µes. Aqui usamos um pico aproximado para voc√™ visualizar risco.",
    "N√£o consideramos INCC e outras corre√ß√µes contratuais (isso pode aumentar valores ao longo do tempo).",
    "N√£o consideramos p√≥s-chaves (algumas construtoras cobram). Se houver, o fluxo muda.",
    "Quer a linha do tempo completa (entrada + evolu√ß√£o da obra + picos) do seu empreendimento? D√° para montar em consultoria."
  ];

  document.getElementById("obsList").innerHTML = obs.map(t=>`<li>${t}</li>`).join("");
  document.getElementById("obs").style.display = "block";
}

function limpar(){
  ["renda","fgts","ato"].forEach(id => document.getElementById(id).value = "");
  document.getElementById("prazoSelect").value = "";

  document.getElementById("cards").style.display = "none";
  document.getElementById("cards").innerHTML = "";
  document.getElementById("obs").style.display = "none";
  document.getElementById("obsList").innerHTML = "";
}

/** ========= Init ========= **/
document.addEventListener("DOMContentLoaded", () => {
  bindMoneyInput(document.getElementById("renda"));
  bindMoneyInput(document.getElementById("fgts"));
  bindMoneyInput(document.getElementById("ato"));

  document.getElementById("btnCalcular").addEventListener("click", calcularFaixas);
  document.getElementById("btnLimpar").addEventListener("click", limpar);
});
</script>

</body>
</html>
