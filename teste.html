<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador Imobili√°rio</title>

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f6f5;
  color:#222;
}

/* ===== TOPO ===== */
.painel-topo{
  background:#fff;
  border-bottom:1px solid #e0e0e0;
  padding:16px;
}

.painel-topo h1{
  text-align:center;
  color:#0b6e3b;
  margin:0 0 16px;
  font-size:22px;
}

.grid-topo{
  max-width:900px;
  margin:0 auto;
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}

.campo label{
  display:block;
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
}

.campo input, .campo select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
}

.campo-full{ grid-column:1 / -1; }

@media(min-width:768px){
  .grid-topo{ grid-template-columns:repeat(2,1fr); }
}

/* ===== CONTE√öDO ===== */
.container{
  max-width:900px;
  margin:24px auto;
  padding:0 16px 40px;
}

/* ===== BLOCOS ===== */
.bloco{
  background:#fff;
  border-radius:14px;
  border:1px solid #ddd;
  margin-bottom:18px;
  overflow:hidden;
}

.bloco-header{
  background:#0b6e3b;
  color:#fff;
  padding:16px;
  font-weight:700;
  cursor:pointer;
}

.bloco-conteudo{
  display:none;
  padding:18px;
}

.subgrid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}

@media(min-width:768px){
  .subgrid{ grid-template-columns:repeat(2,1fr); }
  .span2{ grid-column:1 / -1; }
}

.divider{
  height:1px;
  background:#e9e9e9;
  margin:16px 0;
}

/* ===== BLOCOS VISUAIS ===== */
.bloco-inter{
  background:#f3faf6;
  padding:12px;
  border-radius:10px;
}

.bloco-pos{
  background:#f2f6fb;
  padding:12px;
  border-radius:10px;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#0b6e3b;
  color:#fff;
  font-size:15px;
  cursor:pointer;
  margin-top:12px;
}

button:hover{ background:#095a31; }

.resultado{
  margin-top:14px;
  background:#f1f7f3;
  padding:14px;
  border-radius:10px;
}

.alerta{ color:#c62828; font-weight:700; }
.ok{ color:#0b6e3b; font-weight:700; }

.obs{
  font-size:12px;
  color:#555;
  margin-top:10px;
  font-style:italic;
  line-height:1.4;
}

.pill{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  background:#e7f3eb;
  color:#0b6e3b;
  font-weight:700;
  font-size:12px;
}
</style>
</head>

<body>

<!-- ===== TOPO ===== -->
<div class="painel-topo">
  <h1>Simulador Imobili√°rio</h1>

  <div class="grid-topo">
    <div class="campo campo-full">
      <label>üè† Valor do Im√≥vel (R$)</label>
      <input id="valorImovel" oninput="formatarMoeda(this)">
    </div>

    <div class="campo">
      <label>üè¶ Valor do Financiamento (R$)</label>
      <input id="valorFinanciamento" oninput="formatarMoeda(this)">
    </div>

    <div class="campo">
      <label>üí∞ FGTS (R$) <span class="pill">opcional</span></label>
      <input id="fgts" oninput="formatarMoeda(this)">
    </div>

    <div class="campo">
      <label>üìà Taxa de Juros (% a.a.) <span class="pill">opcional</span></label>
      <input id="taxaJuros" type="number" step="0.01">
    </div>

    <div class="campo">
      <label>üìÖ Prazo da Obra (meses)</label>
      <input id="prazoObra" type="number">
    </div>
  </div>
</div>

<div class="container">

<!-- ===== ENTRADA ===== -->
<div class="bloco">
  <div class="bloco-header" onclick="toggle(this)">üí∞ Entrada / Fluxo Inicial</div>
  <div class="bloco-conteudo">

    <div class="subgrid">
      <div class="campo">
        <label>üí∏ Valor do Ato (R$)</label>
        <input id="ato" oninput="formatarMoeda(this)">
      </div>

      <div class="campo">
        <label>üìÜ Parcelas Mensais da Entrada</label>
        <input id="parcelasEntrada" type="number">
      </div>

      <div class="campo span2">
        <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
        <input id="renda" oninput="formatarMoeda(this)">
      </div>
    </div>

    <div class="divider"></div>

    <!-- INTERMEDI√ÅRIAS -->
    <div class="bloco-inter">
      <div class="subgrid">
        <div class="campo">
          <label>üìä Tem Intermedi√°rias?</label>
          <select id="temInter" onchange="toggleInter()">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo" id="boxQtdInter" style="display:none;">
          <label>üî¢ Quantidade de Intermedi√°rias</label>
          <input id="qtdInter" type="number">
        </div>

        <div class="campo span2" id="boxValorInter" style="display:none;">
          <label>üí∞ Valor da Intermedi√°ria (R$)</label>
          <input id="valorInter" oninput="formatarMoeda(this)">
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- P√ìS-CHAVES -->
    <div class="bloco-pos">
      <div class="subgrid">
        <div class="campo">
          <label>üèóÔ∏è Construtora aceita saldo p√≥s-chaves?</label>
          <select id="aceitaPos" onchange="togglePos()">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo" id="boxPercPos" style="display:none;">
          <label>üìä % m√°ximo do valor do im√≥vel</label>
          <input id="percPos" type="number" step="0.1">
        </div>

        <div class="campo" id="boxParcPos" style="display:none;">
          <label>üìÜ M√°x. parcelas p√≥s-chaves</label>
          <input id="parcelasPos" type="number">
        </div>
      </div>
    </div>

    <button onclick="calcularEntrada()">Calcular Entrada</button>

    <div id="resultadoEntrada" class="resultado"></div>

    <div class="obs">
      * Mensais limitadas a 30% da renda.<br>
      * Intermedi√°rias usam 100% da renda se valor n√£o informado.<br>
      * P√≥s-chaves depende da pol√≠tica da construtora.
    </div>
  </div>
</div>

<!-- ===== JUROS ===== -->
<div class="bloco">
  <div class="bloco-header" onclick="toggle(this)">üè¶ Juros de Obra</div>
  <div class="bloco-conteudo">
    <button onclick="calcularJuros()">Calcular Juros de Obra</button>
    <div id="resultadoJuros" class="resultado"></div>
  </div>
</div>

</div>

<script>
function toggle(h){ h.nextElementSibling.style.display =
  h.nextElementSibling.style.display==="block"?"none":"block"; }

function toggleInter(){
  const s=temInter.value==="sim";
  boxQtdInter.style.display=s?"block":"none";
  boxValorInter.style.display=s?"block":"none";
}

function togglePos(){
  const s=aceitaPos.value==="sim";
  boxPercPos.style.display=s?"block":"none";
  boxParcPos.style.display=s?"block":"none";
}

function formatarMoeda(c){
  let v=c.value.replace(/\D/g,"");
  if(!v){ c.value=""; return; }
  v=(v/100).toFixed(2).replace(".",",");
  v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
  c.value="R$ "+v;
}

function limpar(v){
  return parseFloat(v.replace(/[R$\.\s]/g,"").replace(",","."))||0;
}

function moeda(n){
  return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

function calcularFimObra(meses){
  const hoje=new Date();
  const fim=new Date(hoje.getFullYear(),hoje.getMonth()+meses,1);
  const m=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  return m[fim.getMonth()]+" / "+fim.getFullYear();
}

function calcularEntrada(){
  const im=limpar(valorImovel.value);
  const fi=limpar(valorFinanciamento.value);
  const fg=limpar(fgts.value);
  const at=limpar(ato.value);
  const re=limpar(renda.value);
  const pa=parseInt(parcelasEntrada.value)||0;
  const po=parseInt(prazoObra.value)||0;

  if(!im||!fi||!re||!pa){
    resultadoEntrada.innerHTML="<p class='alerta'>Preencha os campos obrigat√≥rios.</p>";
    return;
  }

  const fim=po?calcularFimObra(po):null;
  let saldo=im-fi-fg-at;

  let interT=0;
  let interU=0;
  if(temInter.value==="sim"){
    const q=parseInt(qtdInter.value)||0;
    interU=limpar(valorInter.value)||re;
    interT=interU*q;
    saldo-=interT;
  }

  const max=re*0.3;
  let mensal=saldo/pa;
  let resto=0;

  if(mensal>max){
    mensal=max;
    resto=saldo-(mensal*pa);
  }

  let posMsg="";
  if(resto>0){
    if(aceitaPos.value!=="sim"){
      posMsg=`<p class='alerta'>Saldo restante ${moeda(resto)} e construtora n√£o aceita p√≥s-chaves.</p>`;
    }else{
      const perc=parseFloat(percPos.value)||0;
      const lim=im*(perc/100);
      posMsg=resto<=lim
        ? `<p class='ok'>P√≥s-chaves vi√°vel: ${moeda(resto)}</p>`
        : `<p class='alerta'>Saldo ${moeda(resto)} excede limite da construtora (${moeda(lim)}).</p>`;
    }
  }

  resultadoEntrada.innerHTML=`
    <h3>Resumo</h3>
    <p>Entrada total: <b>${moeda(im-fi-fg)}</b></p>
    <p>Ato: <b>${moeda(at)}</b></p>
    ${fim?`<p>üìÖ Previs√£o de t√©rmino da obra: <b>${fim}</b></p>`:""}
    <p>Mensais (${pa}x): <b>${moeda(mensal)}</b></p>
    ${posMsg}
  `;
}

function calcularJuros(){
  const fi=limpar(valorFinanciamento.value);
  const pr=parseInt(prazoObra.value)||0;
  const tx=parseFloat(taxaJuros.value)||0;
  if(!fi||!pr||!tx){
    resultadoJuros.innerHTML="<p class='alerta'>Preencha financiamento, prazo e taxa.</p>";
    return;
  }
  const jm=(tx/100)/12;
  resultadoJuros.innerHTML=`<p>Total estimado: <b>${moeda(fi*jm*pr)}</b></p>`;
}
</script>

</body>
</html>
