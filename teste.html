<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Simulador Imobili√°rio</title>

<style>
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f6f5;
  color:#222;
}

/* ===== TOPO ===== */
.painel-topo{
  background:#fff;
  border-bottom:1px solid #e0e0e0;
  padding:16px;
}
.painel-topo h1{
  text-align:center;
  color:#0b6e3b;
  margin:0 0 16px;
  font-size:22px;
}
.grid-topo{
  max-width:900px;
  margin:0 auto;
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
.campo label{
  display:block;
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
}
.campo input, .campo select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
  background:#fff;
}
.campo-full{ grid-column:1 / -1; }

@media(min-width:768px){
  .grid-topo{ grid-template-columns:repeat(2,1fr); }
  .grid-imovel{
    display:grid;
    grid-template-columns:2fr 1fr;
    gap:12px;
    grid-column:1 / -1;
  }
}

/* ===== CONTE√öDO ===== */
.container{
  max-width:900px;
  margin:24px auto;
  padding:0 16px 40px;
}

/* ===== BLOCOS ===== */
.bloco{
  background:#fff;
  border-radius:14px;
  border:1px solid #ddd;
  margin-bottom:18px;
  overflow:hidden;
}
.bloco-header{
  background:#0b6e3b;
  color:#fff;
  padding:14px 16px;
  font-weight:700;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.toggle-icon{
  font-size:18px;
  background:rgba(255,255,255,0.15);
  border-radius:6px;
  width:22px;
  height:22px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.bloco-conteudo{
  display:none;
  padding:18px;
}
.subgrid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
@media(min-width:768px){
  .subgrid{ grid-template-columns:repeat(2,1fr); }
  .span2{ grid-column:1 / -1; }
}
.divider{
  height:1px;
  background:#e9e9e9;
  margin:16px 0;
}

/* ===== VISUAL ===== */
.bloco-inter{ background:#f3faf6; padding:12px; border-radius:10px; }
.bloco-pos{ background:#f2f6fb; padding:12px; border-radius:10px; }

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#0b6e3b;
  color:#fff;
  font-size:15px;
  cursor:pointer;
  margin-top:12px;
}
button:hover{ background:#095a31; }

.resultado{
  margin-top:14px;
  background:#f1f7f3;
  padding:14px;
  border-radius:10px;
}

.alerta{ color:#c62828; font-weight:700; }

.inter-list{ display:flex; flex-direction:column; gap:10px; }
.inter-row{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  padding:10px;
  border-radius:10px;
  background:#fff;
  border:1px solid #e6efe9;
}
@media(min-width:768px){
  .inter-row{ grid-template-columns:1fr 1fr; }
}
.mini-label{ font-size:13px; font-weight:600; }

/* ===== FIXO ===== */
#fluxoBox{
  position:sticky;
  top:10px;
  z-index:10;
}
</style>
</head>

<body>

<div class="painel-topo">
  <h1>Simulador Imobili√°rio</h1>

  <div class="grid-topo">
    <div class="grid-imovel campo-full">
      <div class="campo">
        <label>üè† Valor do Im√≥vel (R$)</label>
        <input id="valorImovel" oninput="formatarMoeda(this)">
      </div>
      <div class="campo">
        <label>üè¢ Unidade / Bloco / Andar</label>
        <input id="unidade">
      </div>
    </div>

    <div class="campo">
      <label>üè¶ Valor do Financiamento (R$)</label>
      <input id="valorFinanciamento" oninput="formatarMoeda(this)">
    </div>

    <div class="campo">
      <label>üí∞ FGTS (R$)</label>
      <input id="fgts" oninput="formatarMoeda(this)">
    </div>

    <div class="campo campo-full">
      <label>üìÖ Previs√£o de Entrega (m√™s/ano)</label>
      <select id="entregaSelect"></select>
    </div>
  </div>
</div>

<div class="container">

<div class="bloco">
  <div class="bloco-header" onclick="toggleBloco(this)">
    <span>üí∞ Entrada / Fluxo Inicial</span>
    <span class="toggle-icon">+</span>
  </div>

  <div class="bloco-conteudo">

    <div class="subgrid">
      <div class="campo">
        <label>üí∏ Valor do Ato (R$)</label>
        <input id="ato" oninput="formatarMoeda(this)">
      </div>

      <div class="campo">
        <label>üóìÔ∏è MESES / PARCELAS</label>
        <input id="parcelasEntrada" type="number">
      </div>

      <div class="campo span2">
        <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
        <input id="renda" oninput="formatarMoeda(this)">
      </div>
    </div>

    <div class="divider"></div>

    <div class="bloco-inter">
      <div class="subgrid">
        <div class="campo">
          <label>üìä Tem Intermedi√°rias?</label>
          <select id="temInter" onchange="toggleInter()">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo">
          <label>üî¢ Quantidade de Intermedi√°rias / Anual</label>
          <input id="qtdInter" type="number" oninput="renderInterRows()">
        </div>

        <div class="campo span2" id="boxInterRows" style="display:none;">
          <div class="inter-list" id="interList"></div>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="bloco-pos">
      <div class="subgrid">
        <div class="campo">
          <label>üèóÔ∏è Construtora aceita saldo p√≥s-chaves?</label>
          <select id="aceitaPos" onchange="togglePos()">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo" id="boxPercPos" style="display:none;">
          <label>üìä % m√°ximo do valor do im√≥vel</label>
          <input id="percPos" type="number" step="0.1">
        </div>

        <div class="campo" id="boxParcPos" style="display:none;">
          <label>üìÜ M√°x. parcelas p√≥s-chaves</label>
          <input id="parcelasPos" type="number">
        </div>
      </div>
    </div>

    <button onclick="calcularEntrada()">Calcular Entrada</button>

    <div id="fluxoBox">
      <div id="resultadoEntrada" class="resultado"></div>
      <button onclick="limparFluxo()">Limpar Fluxo</button>
    </div>

  </div>
</div>

</div>

<script>
function formatarMoeda(c){
  let v=(c.value||"").replace(/\D/g,"");
  if(!v){ c.value=""; return; }
  v=(parseInt(v)/100).toFixed(2).replace(".",",");
  v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
  c.value="R$ "+v;
}
function limpar(v){
  return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", "."))||0;
}
function moeda(n){
  return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}
function gerarMesAno(){
  const hoje=new Date(), arr=[];
  const m=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
  for(let i=0;i<48;i++){
    const d=new Date(hoje.getFullYear(),hoje.getMonth()+i,1);
    arr.push({v:`${d.getFullYear()}-${d.getMonth()+1}`, t:`${m[d.getMonth()]}/${String(d.getFullYear()).slice(-2)}`});
  }
  return arr;
}
(function(){
  const sel=document.getElementById("entregaSelect");
  gerarMesAno().forEach(o=>{
    const op=document.createElement("option");
    op.value=o.v; op.textContent=o.t;
    sel.appendChild(op);
  });
})();

function toggleBloco(el){
  const c=el.nextElementSibling;
  const i=el.querySelector(".toggle-icon");
  const aberto=c.style.display==="block";
  c.style.display=aberto?"none":"block";
  i.textContent=aberto?"+":"‚Äì";
}

function toggleInter(){
  document.getElementById("boxInterRows").style.display =
    document.getElementById("temInter").value==="sim"?"block":"none";
  renderInterRows();
}

function renderInterRows(){
  const q=parseInt(document.getElementById("qtdInter").value)||0;
  const list=document.getElementById("interList");
  list.innerHTML="";
  for(let i=1;i<=q;i++){
    const r=document.createElement("div");
    r.className="inter-row";
    r.innerHTML=`
      <div>
        <span class="mini-label">${i}¬™ Intermedi√°ria / Anual</span>
        <select>${gerarMesAno().map(o=>`<option value="${o.v}">${o.t}</option>`).join("")}</select>
      </div>
      <div>
        <span class="mini-label">Valor (R$)</span>
        <input oninput="formatarMoeda(this)">
      </div>`;
    list.appendChild(r);
  }
}

function togglePos(){
  const s=document.getElementById("aceitaPos").value==="sim";
  boxPercPos.style.display=s?"block":"none";
  boxParcPos.style.display=s?"block":"none";
}

function calcularEntrada(){
  const im=limpar(valorImovel.value),
        fi=limpar(valorFinanciamento.value),
        fg=limpar(fgts.value),
        at=limpar(ato.value),
        re=limpar(renda.value),
        p=parseInt(parcelasEntrada.value)||0;

  const out=document.getElementById("resultadoEntrada");
  if(!im||!fi||!re||!p){
    out.innerHTML="<p class='alerta'>Preencha os campos obrigat√≥rios.</p>";
    return;
  }

  let entrada=im-fi-fg;
  let saldo=entrada-at;

  let interTotal=0;
  document.querySelectorAll("#interList input").forEach(i=>{
    interTotal+=limpar(i.value)||re;
  });
  saldo-=interTotal;

  let mensal=saldo/p;
  let resto=0;
  if(mensal>re*0.3){
    mensal=re*0.3;
    resto=saldo-(mensal*p);
  }

  let aviso="";
  if(resto>0){
    aviso=`<p class="alerta">Saldo restante: ${moeda(resto)}</p>`;
  }

  out.innerHTML=`
    <h3>Fluxo de Pagamento ‚Äì Entrada</h3>
    <p>üìÖ Previs√£o de entrega: <b>${entregaSelect.selectedOptions[0]?.textContent||"-"}</b></p>
    <p>Entrada total: <b>${moeda(entrada)}</b></p>
    <div class="divider"></div>
    <p>Ato: <b>${moeda(at)}</b></p>
    <p>Intermedi√°rias (${document.querySelectorAll("#interList input").length}): <b>${moeda(interTotal)}</b></p>
    <p>Mensais (${p}x): <b>${moeda(mensal)}</b></p>
    ${aviso}
  `;
}

function limparFluxo(){
  document.getElementById("resultadoEntrada").innerHTML="";
}
</script>

</body>
</html>
