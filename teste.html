<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador Imobili√°rio</title>

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f6f5;
  color:#222;
}

/* ===== PAINEL SUPERIOR (N√ÉO FIXO) ===== */
.painel-topo{
  background:#fff;
  border-bottom:1px solid #e0e0e0;
  padding:16px;
}

.painel-topo h1{
  text-align:center;
  color:#0b6e3b;
  margin:0 0 16px;
  font-size:22px;
}

.grid-topo{
  max-width:900px;
  margin:0 auto;
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}

.campo label{
  display:block;
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
}

.campo input, .campo select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
}

.campo-full{ grid-column:1 / -1; }

@media(min-width:768px){
  .grid-topo{ grid-template-columns:repeat(2,1fr); }
}

/* ===== CONTE√öDO ===== */
.container{
  max-width:900px;
  margin:24px auto;
  padding:0 16px 40px;
}

/* ===== BLOCOS ===== */
.bloco{
  background:#fff;
  border-radius:14px;
  border:1px solid #ddd;
  margin-bottom:18px;
  overflow:hidden;
}

.bloco-header{
  background:#0b6e3b;
  color:#fff;
  padding:16px;
  font-weight:700;
  cursor:pointer;
}

.bloco-conteudo{
  display:none;
  padding:18px;
}

.subgrid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}

@media(min-width:768px){
  .subgrid{ grid-template-columns:repeat(2,1fr); }
  .span2{ grid-column:1 / -1; }
}

.divider{
  height:1px;
  background:#e9e9e9;
  margin:16px 0;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#0b6e3b;
  color:#fff;
  font-size:15px;
  cursor:pointer;
  margin-top:12px;
}

button:hover{ background:#095a31; }

.resultado{
  margin-top:14px;
  background:#f1f7f3;
  padding:14px;
  border-radius:10px;
}

.alerta{
  color:#c62828;
  font-weight:700;
}

.ok{
  color:#0b6e3b;
  font-weight:700;
}

.obs{
  font-size:12px;
  color:#555;
  margin-top:10px;
  font-style:italic;
  line-height:1.4;
}

.pill{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  background:#e7f3eb;
  color:#0b6e3b;
  font-weight:700;
  font-size:12px;
}
</style>
</head>

<body>

<!-- ===== TOPO ===== -->
<div class="painel-topo">
  <h1>Simulador Imobili√°rio</h1>

  <div class="grid-topo">
    <div class="campo campo-full">
      <label>üè† Valor do Im√≥vel (R$)</label>
      <input id="valorImovel" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
    </div>

    <div class="campo">
      <label>üè¶ Valor do Financiamento (R$)</label>
      <input id="valorFinanciamento" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
    </div>

    <div class="campo">
      <label>üí∞ FGTS (R$) <span class="pill">opcional</span></label>
      <input id="fgts" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
    </div>

    <div class="campo">
      <label>üìà Taxa de Juros (% a.a.) <span class="pill">opcional</span></label>
      <input id="taxaJuros" type="number" step="0.01" placeholder="Ex: 10,5">
    </div>

    <div class="campo">
      <label>üìÖ Prazo da Obra (meses)</label>
      <input id="prazoObra" type="number" placeholder="Ex: 35">
    </div>
  </div>
</div>

<div class="container">

<!-- ===== ENTRADA ===== -->
<div class="bloco">
  <div class="bloco-header" onclick="toggle(this)">üí∞ Entrada / Fluxo Inicial</div>
  <div class="bloco-conteudo">

    <div class="subgrid">
      <div class="campo">
        <label>üí∏ Valor do Ato (R$)</label>
        <input id="ato" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
      </div>

      <div class="campo">
        <label>üìÜ Parcelas Mensais da Entrada</label>
        <input id="parcelasEntrada" type="number" placeholder="Ex: 34">
      </div>

      <div class="campo span2">
        <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
        <input id="renda" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
      </div>
    </div>

    <div class="divider"></div>

    <div class="subgrid">
      <div class="campo">
        <label>üìä Tem Intermedi√°rias?</label>
        <select id="temInter" onchange="toggleInter()">
          <option value="nao">N√£o</option>
          <option value="sim">Sim</option>
        </select>
      </div>

      <div class="campo" id="boxQtdInter" style="display:none;">
        <label>üî¢ Quantidade de Intermedi√°rias</label>
        <input id="qtdInter" type="number">
      </div>

      <div class="campo span2" id="boxValorInter" style="display:none;">
        <label>üí∞ Valor da Intermedi√°ria (R$) <span class="pill">se vazio, usa 100% da renda</span></label>
        <input id="valorInter" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
      </div>
    </div>

    <div class="divider"></div>

    <div class="subgrid">
      <div class="campo">
        <label>üèóÔ∏è Construtora aceita saldo p√≥s-chaves?</label>
        <select id="aceitaPos" onchange="togglePos()">
          <option value="nao">N√£o</option>
          <option value="sim">Sim</option>
        </select>
      </div>

      <div class="campo" id="boxPercPos" style="display:none;">
        <label>üìä % m√°ximo do valor do im√≥vel</label>
        <input id="percPos" type="number" step="0.1" placeholder="Ex: 8">
      </div>

      <div class="campo" id="boxParcPos" style="display:none;">
        <label>üìÜ M√°x. parcelas p√≥s-chaves</label>
        <input id="parcelasPos" type="number" placeholder="Ex: 24">
      </div>
    </div>

    <button onclick="calcularEntrada()">Calcular Entrada</button>

    <div id="resultadoEntrada" class="resultado"></div>

    <div class="obs">
      * Mensais limitadas a 30% da renda.<br>
      * Intermedi√°rias: se valor vazio, usa 100% da renda.<br>
      * P√≥s-chaves depende da regra da construtora.
    </div>
  </div>
</div>

<!-- ===== JUROS DE OBRA ===== -->
<div class="bloco">
  <div class="bloco-header" onclick="toggle(this)">üè¶ Juros de Obra</div>
  <div class="bloco-conteudo">

    <button onclick="calcularJuros()">Calcular Juros de Obra</button>

    <div id="resultadoJuros" class="resultado"></div>

    <div class="obs">
      * C√°lculo estimado (juros simples). N√£o considera TR ou varia√ß√µes banc√°rias.
    </div>
  </div>
</div>

</div>

<script>
/* ===== UI ===== */
function toggle(h){
  const c = h.nextElementSibling;
  c.style.display = c.style.display === "block" ? "none" : "block";
}

function toggleInter(){
  const sim = temInter.value === "sim";
  boxQtdInter.style.display = sim ? "block" : "none";
  boxValorInter.style.display = sim ? "block" : "none";
}

function togglePos(){
  const sim = aceitaPos.value === "sim";
  boxPercPos.style.display = sim ? "block" : "none";
  boxParcPos.style.display = sim ? "block" : "none";
}

/* ===== MOEDA ===== */
function formatarMoeda(c){
  let v = c.value.replace(/\D/g,"");
  if(!v){ c.value=""; return; }
  v = (v/100).toFixed(2).replace(".",",");
  v = v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
  c.value = "R$ " + v;
}

function limpar(v){
  return parseFloat(v.replace(/[R$\.\s]/g,"").replace(",",".")) || 0;
}

function moeda(n){
  return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

/* ===== ENTRADA ===== */
function calcularEntrada(){
  const imovel = limpar(valorImovel.value);
  const financ = limpar(valorFinanciamento.value);
  const fgtsV = limpar(fgts.value);
  const atoV = limpar(ato.value);
  const rendaV = limpar(renda.value);
  const parcelas = parseInt(parcelasEntrada.value)||0;

  if(!imovel||!financ||!rendaV||!parcelas){
    resultadoEntrada.innerHTML="<p class='alerta'>Preencha os campos obrigat√≥rios.</p>";
    return;
  }

  const entradaTotal = imovel - financ - fgtsV;
  if(entradaTotal<=0){
    resultadoEntrada.innerHTML="<p class='alerta'>Entrada inv√°lida.</p>";
    return;
  }

  let saldo = entradaTotal - atoV;
  if(saldo<0){
    resultadoEntrada.innerHTML="<p class='alerta'>Ato maior que a entrada.</p>";
    return;
  }

  let interTotal = 0;
  let interUnit = 0;

  if(temInter.value==="sim"){
    const q = parseInt(qtdInter.value)||0;
    if(!q){
      resultadoEntrada.innerHTML="<p class='alerta'>Informe a quantidade de intermedi√°rias.</p>";
      return;
    }
    interUnit = limpar(valorInter.value)||rendaV;
    interTotal = interUnit*q;
    saldo -= interTotal;
    if(saldo<0){
      resultadoEntrada.innerHTML="<p class='alerta'>Intermedi√°rias maiores que o saldo.</p>";
      return;
    }
  }

  const mensalMax = rendaV*0.3;
  let mensalCalc = saldo/parcelas;
  let mensalFinal = mensalCalc;
  let saldoPos = 0;
  let aviso = "";

  if(mensalCalc>mensalMax){
    mensalFinal = mensalMax;
    saldoPos = saldo - mensalFinal*parcelas;
    aviso = "<p class='alerta'>Mensais limitadas a 30% da renda.</p>";
  }

  let posMsg="";
  if(saldoPos>0){
    if(aceitaPos.value!=="sim"){
      posMsg=`<p class='alerta'>Saldo restante ${moeda(saldoPos)} e construtora n√£o aceita p√≥s-chaves.</p>`;
    }else{
      const perc = parseFloat(percPos.value)||0;
      const maxParc = parseInt(parcelasPos.value)||0;
      const limite = imovel*(perc/100);
      if(!perc||!maxParc){
        posMsg="<p class='alerta'>Informe as regras do p√≥s-chaves.</p>";
      }else if(saldoPos>limite){
        posMsg=`<p class='alerta'>Saldo p√≥s-chaves ${moeda(saldoPos)} ultrapassa o limite ${moeda(limite)}.</p>`;
      }else{
        posMsg=`<p class='ok'>P√≥s-chaves vi√°vel: ${moeda(saldoPos)} em at√© ${maxParc} parcelas.</p>`;
      }
    }
  }

  resultadoEntrada.innerHTML=`
    <h3>Resumo</h3>
    <p>Entrada total: <b>${moeda(entradaTotal)}</b></p>
    <p>Ato: <b>${moeda(atoV)}</b></p>
    <p>Intermedi√°rias: <b>${temInter.value==="sim"?moeda(interUnit)+" x "+qtdInter.value:"N√£o"}</b></p>
    <p>Mensais (${parcelas}x): <b>${moeda(mensalFinal)}</b></p>
    ${aviso}
    ${posMsg}
  `;
}

/* ===== JUROS ===== */
function calcularJuros(){
  const financ = limpar(valorFinanciamento.value);
  const prazo = parseInt(prazoObra.value)||0;
  const taxa = parseFloat(taxaJuros.value)||0;

  if(!financ||!prazo){
    resultadoJuros.innerHTML="<p class='alerta'>Preencha financiamento e prazo.</p>";
    return;
  }
  if(!taxa){
    resultadoJuros.innerHTML="<p class='alerta'>Informe a taxa de juros.</p>";
    return;
  }

  const jm = (taxa/100)/12;
  const total = financ*jm*prazo;

  resultadoJuros.innerHTML=`
    <h3>Juros de Obra (estimado)</h3>
    <p>Total estimado: <b>${moeda(total)}</b></p>
  `;
}
</script>

</body>
</html>
