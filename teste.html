<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador Imobili√°rio</title>

<style>
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f6f5;
  color:#222;
}
.painel-topo{
  background:#fff;
  border-bottom:1px solid #e0e0e0;
  padding:16px;
}
.painel-topo h1{
  text-align:center;
  color:#0b6e3b;
  margin:0 0 16px;
  font-size:22px;
}
.grid-topo{
  max-width:900px;
  margin:0 auto;
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
.campo label{
  display:block;
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
}
.campo input,.campo select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
}
.campo-full{ grid-column:1/-1; }

@media(min-width:768px){
  .grid-topo{ grid-template-columns:repeat(2,1fr); }
  .grid-imovel{
    grid-column:1/-1;
    display:grid;
    grid-template-columns:2fr 1fr;
    gap:12px;
  }
}

.container{
  max-width:900px;
  margin:24px auto;
  padding:0 16px 40px;
}

.bloco{
  background:#fff;
  border-radius:14px;
  border:1px solid #ddd;
  margin-bottom:18px;
  overflow:hidden;
}
.bloco-header{
  background:#0b6e3b;
  color:#fff;
  padding:14px 16px;
  font-weight:700;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.toggle-icon{
  background:rgba(255,255,255,0.15);
  border-radius:6px;
  width:22px;
  height:22px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.bloco-conteudo{ display:none; padding:18px; }

.subgrid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
@media(min-width:768px){
  .subgrid{ grid-template-columns:repeat(2,1fr); }
  .span2{ grid-column:1/-1; }
}

.divider{
  height:1px;
  background:#e9e9e9;
  margin:16px 0;
}

.bloco-inter{ background:#f3faf6; padding:12px; border-radius:10px; }
.bloco-pos{ background:#f2f6fb; padding:12px; border-radius:10px; }

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#0b6e3b;
  color:#fff;
  font-size:15px;
  cursor:pointer;
  margin-top:12px;
}

.resultado{
  margin-top:14px;
  background:#f1f7f3;
  padding:14px;
  border-radius:10px;
}

.alerta{ color:#c62828; font-weight:700; }

.inter-list{ display:flex; flex-direction:column; gap:10px; }
.inter-row{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  background:#fff;
  border:1px solid #e6efe9;
  padding:10px;
  border-radius:10px;
}
@media(min-width:768px){
  .inter-row{ grid-template-columns:1fr 1fr; }
}

#fluxoBox{ position:sticky; top:10px; z-index:5; }
</style>
</head>

<body>

<div class="painel-topo">
  <h1>Simulador Imobili√°rio</h1>
  <div class="grid-topo">

    <div class="grid-imovel">
      <div class="campo">
        <label>üè† Valor do Im√≥vel (R$)</label>
        <input id="valorImovel" oninput="formatarMoeda(this)">
      </div>
      <div class="campo">
        <label>üè¢ Unidade / Bloco / Andar</label>
        <input id="unidade">
      </div>
    </div>

    <div class="campo">
      <label>üè¶ Valor do Financiamento (R$)</label>
      <input id="valorFinanciamento" oninput="formatarMoeda(this)">
    </div>

    <div class="campo">
      <label>üí∞ FGTS (R$)</label>
      <input id="fgts" oninput="formatarMoeda(this)">
    </div>

    <div class="campo campo-full">
      <label>üìÖ Previs√£o de Entrega (m√™s/ano)</label>
      <select id="entregaSelect"></select>
    </div>
  </div>
</div>

<div class="container">

<div class="bloco">
  <div class="bloco-header" onclick="toggleBloco(this)">
    <span>üí∞ Entrada / Fluxo Inicial</span>
    <span class="toggle-icon">+</span>
  </div>

  <div class="bloco-conteudo">

    <div class="subgrid">
      <div class="campo">
        <label>üí∏ Valor do Ato (R$)</label>
        <input id="ato" oninput="formatarMoeda(this)">
      </div>

      <div class="campo">
        <label>üóìÔ∏è MESES / PARCELAS</label>
        <input id="parcelasEntrada" type="number">
      </div>

      <div class="campo span2">
        <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
        <input id="renda" oninput="formatarMoeda(this)">
      </div>
    </div>

    <div class="divider"></div>

    <div class="bloco-inter">
      <div class="subgrid">
        <div class="campo">
          <label>üìä Tem Intermedi√°rias?</label>
          <select id="temInter" onchange="toggleInter()">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo" id="boxQtdInter" style="display:none;">
          <label>üî¢ Quantidade de Intermedi√°rias / Anual</label>
          <input id="qtdInter" type="number" oninput="renderInterRows()">
        </div>

        <div class="campo span2" id="boxInterRows" style="display:none;">
          <div class="inter-list" id="interList"></div>
        </div>
      </div>
    </div>

    <button onclick="calcularEntrada()">Calcular Entrada</button>

    <div id="fluxoBox">
      <div id="resultadoEntrada" class="resultado"></div>
      <button onclick="limparFluxo()">Limpar Fluxo</button>
    </div>

  </div>
</div>

</div>

<script>
function formatarMoeda(c){
  let v=(c.value||"").replace(/\D/g,"");
  if(!v){ c.value=""; return; }
  v=(parseInt(v)/100).toFixed(2).replace(".",",");
  v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
  c.value="R$ "+v;
}
function limpar(v){
  return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", "."))||0;
}
function moeda(n){
  return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

function gerarMesAno(){
  const h=new Date(), arr=[];
  const m=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
  for(let i=0;i<48;i++){
    const d=new Date(h.getFullYear(),h.getMonth()+i,1);
    arr.push(`${m[d.getMonth()]}/${String(d.getFullYear()).slice(-2)}`);
  }
  return arr;
}

(function(){
  const sel=document.getElementById("entregaSelect");
  gerarMesAno().forEach(t=>{
    const o=document.createElement("option");
    o.textContent=t; sel.appendChild(o);
  });
})();

function toggleBloco(el){
  const conteudo=el.nextElementSibling;
  const icon=el.querySelector(".toggle-icon");
  const aberto=conteudo.style.display==="block";
  conteudo.style.display=aberto?"none":"block";
  icon.textContent=aberto?"+":"‚Äì";
}

function toggleInter(){
  const sim=document.getElementById("temInter").value==="sim";
  boxQtdInter.style.display=sim?"block":"none";
  boxInterRows.style.display=sim?"block":"none";
  if(!sim){
    qtdInter.value="";
    interList.innerHTML="";
  }
}

function renderInterRows(){
  const q=parseInt(qtdInter.value)||0;
  interList.innerHTML="";
  const meses=gerarMesAno();
  for(let i=1;i<=q;i++){
    const r=document.createElement("div");
    r.className="inter-row";
    r.innerHTML=`
      <div>
        <label>${i}¬™ Intermedi√°ria / Anual</label>
        <select>${meses.map(m=>`<option>${m}</option>`).join("")}</select>
      </div>
      <div>
        <label>Valor (R$)</label>
        <input oninput="formatarMoeda(this)">
      </div>`;
    interList.appendChild(r);
  }
}

function calcularEntrada(){
  const im=limpar(valorImovel.value),
        fi=limpar(valorFinanciamento.value),
        fg=limpar(fgts.value),
        at=limpar(ato.value),
        re=limpar(renda.value),
        p=parseInt(parcelasEntrada.value)||0;

  const out=resultadoEntrada;
  if(!im||!fi||!re||!p){
    out.innerHTML="<p class='alerta'>Preencha os campos obrigat√≥rios.</p>";
    return;
  }

  const entrada=im-fi-fg;
  let saldo=entrada-at;

  const interVals=[];
  if(temInter.value==="sim"){
    document.querySelectorAll("#interList input").forEach(i=>{
      interVals.push(limpar(i.value)||re);
    });
  }

  interVals.forEach(v=>saldo-=v);

  let mensal=saldo/p;
  let resto=0;
  if(mensal>re*0.3){
    mensal=re*0.3;
    resto=saldo-(mensal*p);
  }

  let interTexto="";
  if(interVals.length){
    const iguais=interVals.every(v=>v===interVals[0]);
    interTexto=iguais
      ? `Intermedi√°rias (${interVals.length}x): <b>${moeda(interVals[0])}</b>`
      : `Intermedi√°rias (${interVals.length}x): <b>${interVals.map(v=>moeda(v)).join(" | ")}</b>`;
  }

  out.innerHTML=`
    <h3>Fluxo de Pagamento ‚Äì Entrada</h3>
    <p>üìÖ Previs√£o de entrega: <b>${entregaSelect.value||"-"}</b></p>
    <p>Entrada total: <b>${moeda(entrada)}</b></p>
    <div class="divider"></div>
    <p>Ato: <b>${moeda(at)}</b></p>
    ${interTexto}
    <p>Mensais (${p}x): <b>${moeda(mensal)}</b></p>
    ${resto>0?`<p class="alerta">Saldo restante: ${moeda(resto)}</p>`:""}
  `;
}

function limparFluxo(){
  resultadoEntrada.innerHTML="";
}
</script>

</body>
</html>
