<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Simulador - Entrada & Juros de Obra</title>

<style>
  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    background:#f4f6f5;
    color:#222;
  }

  /* ===== PAINEL FIXO SUPERIOR ===== */
  .painel-fixo{
    position: sticky;
    top: 0;
    z-index: 1000;
    background: #fff;
    border-bottom: 1px solid #e0e0e0;
    padding: 16px;
  }

  .painel-fixo h1{
    margin: 0 0 16px 0;
    text-align:center;
    color:#0b6e3b;
    font-size: 20px;
  }

  .painel-grid{
    max-width: 900px;
    margin: 0 auto;
    display:grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .campo label{
    display:block;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .campo input, .campo select{
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 15px;
    background:#fff;
  }

  .campo-full{
    grid-column: 1 / -1;
  }

  @media(min-width:768px){
    .painel-grid{ grid-template-columns: repeat(2, 1fr); }
    .painel-fixo h1{ font-size: 22px; }
  }

  /* ===== CONTE√öDO ===== */
  .container{
    max-width: 900px;
    margin: 24px auto;
    padding: 0 16px 40px;
  }

  /* ===== ACCORDION ===== */
  .bloco{
    background:#fff;
    border-radius: 14px;
    border:1px solid #ddd;
    overflow:hidden;
    margin-bottom: 16px;
  }

  .bloco-header{
    padding: 16px;
    background:#0b6e3b;
    color:#fff;
    font-weight: 700;
    cursor:pointer;
    user-select:none;
  }

  .bloco-conteudo{
    display:none;
    padding: 18px;
  }

  .subgrid{
    display:grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }

  @media(min-width:768px){
    .subgrid{ grid-template-columns: repeat(2, 1fr); }
    .subgrid .span2{ grid-column: 1 / -1; }
  }

  .divider{
    height:1px;
    background:#e9e9e9;
    margin: 14px 0;
  }

  button{
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 10px;
    background:#0b6e3b;
    color:#fff;
    font-size: 15px;
    cursor:pointer;
    margin-top: 12px;
  }

  button:hover{ background:#095a31; }

  .resultado{
    margin-top: 14px;
    background:#f1f7f3;
    padding: 14px;
    border-radius: 10px;
  }

  .alerta{
    color:#c62828;
    font-weight: 700;
  }

  .obs{
    margin-top: 10px;
    font-size: 12px;
    color:#555;
    font-style: italic;
    line-height: 1.35;
  }

  .pill{
    display:inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    background:#e7f3eb;
    color:#0b6e3b;
    font-weight:700;
    font-size: 12px;
  }
</style>
</head>

<body>

<!-- ===== PAINEL FIXO (sempre vis√≠vel) ===== -->
<div class="painel-fixo">
  <h1>Simulador</h1>

  <div class="painel-grid">
    <div class="campo campo-full">
      <label>üè† Valor do Im√≥vel (R$)</label>
      <input id="valorImovel" inputmode="numeric" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
    </div>

    <div class="campo">
      <label>üè¶ Valor do Financiamento (R$)</label>
      <input id="valorFinanciamento" inputmode="numeric" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
    </div>

    <div class="campo">
      <label>üìà Taxa de Juros (% a.a.) <span class="pill">opcional</span></label>
      <input id="taxaJuros" type="number" step="0.01" placeholder="Ex: 10,50">
    </div>

    <div class="campo">
      <label>üí∞ FGTS (R$) <span class="pill">opcional</span></label>
      <input id="fgts" inputmode="numeric" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
    </div>

    <div class="campo">
      <label>üìÖ Prazo da Obra (meses)</label>
      <input id="prazoObra" type="number" placeholder="Ex: 35">
    </div>
  </div>
</div>

<div class="container">

  <!-- ===== ENTRADA / FLUXO ===== -->
  <div class="bloco">
    <div class="bloco-header" onclick="toggleBloco(this)">üí∞ Entrada / Fluxo Inicial</div>
    <div class="bloco-conteudo">

      <div class="subgrid">
        <div class="campo">
          <label>üí∏ Ato (R$)</label>
          <input id="ato" inputmode="numeric" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
        </div>

        <div class="campo">
          <label>üìÜ Parcelas da Entrada (ex: Ato + 34)</label>
          <input id="parcelasEntrada" type="number" placeholder="Ex: 34">
        </div>

        <div class="campo span2">
          <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
          <input id="renda" inputmode="numeric" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
        </div>
      </div>

      <div class="divider"></div>

      <div class="subgrid">
        <div class="campo">
          <label>üìä Tem intermedi√°rias?</label>
          <select id="temInter" onchange="mostrarInter()">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo" id="campoQtdInter" style="display:none;">
          <label>üî¢ Quantidade de intermedi√°rias</label>
          <input id="qtdInter" type="number" placeholder="Ex: 3">
        </div>

        <div class="campo span2" id="campoValorInter" style="display:none;">
          <label>üí∞ Valor da intermedi√°ria (R$) <span class="pill">se vazio, usa 100% da renda</span></label>
          <input id="valorInter" inputmode="numeric" oninput="formatarMoeda(this)" placeholder="R$ 0,00">
        </div>
      </div>

      <button onclick="calcularEntrada()">Calcular Entrada</button>

      <div id="resultadoEntrada" class="resultado"></div>

      <div class="obs">
        * A entrada √©: <b>Valor do im√≥vel - financiamento - FGTS</b>.<br>
        * Parcelas mensais limitadas a <b>30% da renda</b>.<br>
        * Intermedi√°rias limitadas a <b>100% da renda</b> (quando valor n√£o √© informado).
      </div>
    </div>
  </div>

  <!-- ===== JUROS DE OBRA ===== -->
  <div class="bloco">
    <div class="bloco-header" onclick="toggleBloco(this)">üè¶ Juros de Obra</div>
    <div class="bloco-conteudo">

      <div class="obs" style="margin-top:0;">
        Este c√°lculo usa: <b>Financiamento</b>, <b>Prazo da obra</b> e <b>Taxa de juros</b> (do painel superior).
      </div>

      <button onclick="calcularJurosObra()">Calcular Juros de Obra</button>

      <div id="resultadoJuros" class="resultado"></div>

      <div class="obs">
        * Estimativa simples: juros mensal = (taxa a.a. / 12). N√£o considera TR/varia√ß√µes do banco.
      </div>
    </div>
  </div>

</div>

<script>
  /* ===== UI ===== */
  function toggleBloco(header){
    const conteudo = header.nextElementSibling;
    conteudo.style.display = (conteudo.style.display === "block") ? "none" : "block";
  }

  function mostrarInter(){
    const sim = document.getElementById("temInter").value === "sim";
    document.getElementById("campoQtdInter").style.display = sim ? "block" : "none";
    document.getElementById("campoValorInter").style.display = sim ? "block" : "none";
    if(!sim){
      document.getElementById("qtdInter").value = "";
      document.getElementById("valorInter").value = "";
    }
  }

  /* ===== Formata√ß√£o moeda ===== */
  function formatarMoeda(campo){
    let v = (campo.value || "").replace(/\D/g, "");
    if(v.length === 0){
      campo.value = "";
      return;
    }
    v = (parseInt(v,10) / 100).toFixed(2);
    v = v.replace(".", ",");
    v = v.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    campo.value = "R$ " + v;
  }

  function limparMoeda(v){
    return parseFloat((v || "").replace(/[R$\.\s]/g, "").replace(",", ".")) || 0;
  }

  function moeda(num){
    return num.toLocaleString("pt-BR",{ style:"currency", currency:"BRL" });
  }

  /* ===== C√°lculo Entrada ===== */
  function calcularEntrada(){
    const valorImovel = limparMoeda(document.getElementById("valorImovel").value);
    const financiamento = limparMoeda(document.getElementById("valorFinanciamento").value);
    const fgts = limparMoeda(document.getElementById("fgts").value);

    const ato = limparMoeda(document.getElementById("ato").value);
    const parcelasEntrada = parseInt(document.getElementById("parcelasEntrada").value) || 0;
    const renda = limparMoeda(document.getElementById("renda").value);

    const temInter = document.getElementById("temInter").value === "sim";
    const qtdInter = temInter ? (parseInt(document.getElementById("qtdInter").value) || 0) : 0;
    const valorInterManual = temInter ? limparMoeda(document.getElementById("valorInter").value) : 0;

    const out = document.getElementById("resultadoEntrada");

    // valida√ß√µes m√≠nimas
    if(!valorImovel || !financiamento){
      out.innerHTML = `<p class="alerta">Preencha Valor do Im√≥vel e Valor do Financiamento no painel superior.</p>`;
      return;
    }
    if(!renda || !parcelasEntrada){
      out.innerHTML = `<p class="alerta">Preencha Renda Mensal e Parcelas da Entrada.</p>`;
      return;
    }

    const entradaTotal = valorImovel - financiamento - fgts;
    if(entradaTotal <= 0){
      out.innerHTML = `<p class="alerta">A entrada calculada ficou <= 0. Verifique im√≥vel, financiamento e FGTS.</p>`;
      return;
    }

    // Ato n√£o √© "obrigat√≥rio" tecnicamente, mas faz parte do seu fluxo
    // Se vier vazio, trata como 0 (sem quebrar).
    const entradaRestanteBruta = entradaTotal - ato;

    if(entradaRestanteBruta < 0){
      out.innerHTML = `<p class="alerta">O Ato est√° maior que a entrada total. Ajuste o valor do ato.</p>`;
      return;
    }

    // Intermedi√°rias
    let interValorUnit = 0;
    let totalInter = 0;

    if(temInter){
      if(qtdInter <= 0){
        out.innerHTML = `<p class="alerta">Voc√™ marcou que tem intermedi√°rias, mas n√£o informou a quantidade.</p>`;
        return;
      }
      // se valor estiver vazio, usa 100% da renda
      interValorUnit = (valorInterManual > 0) ? valorInterManual : renda;

      totalInter = interValorUnit * qtdInter;
    }

    // Saldo ap√≥s intermedi√°rias
    let saldoAposInter = entradaRestanteBruta - totalInter;

    // Se intermedi√°rias comeram mais que o saldo, vira "saldo negativo" (ou seja, passou do necess√°rio)
    // Aqui vamos travar porque n√£o faz sentido intermedi√°rias serem maiores que o saldo da entrada.
    if(saldoAposInter < 0){
      out.innerHTML = `
        <p class="alerta">As intermedi√°rias est√£o maiores que a entrada restante ap√≥s o ato.</p>
        <p>Entrada restante (ap√≥s ato): <b>${moeda(entradaRestanteBruta)}</b></p>
        <p>Total intermedi√°rias: <b>${moeda(totalInter)}</b></p>
        <p class="obs">Ajuste a quantidade/valor das intermedi√°rias para n√£o ultrapassar o saldo da entrada.</p>
      `;
      return;
    }

    // Mensais limitadas a 30% da renda
    const mensalMax = renda * 0.30;
    let mensalCalculada = (parcelasEntrada > 0) ? (saldoAposInter / parcelasEntrada) : 0;

    let mensalFinal = mensalCalculada;
    let saldoPosChaves = 0;
    let alertaLimite = "";

    if(mensalCalculada > mensalMax){
      mensalFinal = mensalMax;
      const totalCobertoMensais = mensalFinal * parcelasEntrada;
      saldoPosChaves = saldoAposInter - totalCobertoMensais;

      alertaLimite = `<p class="alerta">‚ö†Ô∏è No c√°lculo direto, as mensais ultrapassariam 30% da renda. Aplicamos o limite e sobrou saldo.</p>`;
    } else {
      saldoPosChaves = 0;
    }

    // Monta sa√≠da
    const entradaRestanteAposAto = entradaRestanteBruta;
    const entradaRestanteAposInter = saldoAposInter;

    out.innerHTML = `
      <h3 style="margin-top:0;">Resumo da Entrada</h3>

      <p>Entrada total: <b>${moeda(entradaTotal)}</b></p>
      <p>Ato: <b>${moeda(ato)}</b></p>

      <div class="divider"></div>

      <p>Entrada restante (ap√≥s ato): <b>${moeda(entradaRestanteAposAto)}</b></p>

      ${temInter ? `
        <p>Intermedi√°rias (${qtdInter}x): <b>${moeda(interValorUnit)}</b></p>
        <p>Total intermedi√°rias: <b>${moeda(totalInter)}</b></p>
        <p>Saldo para mensais (ap√≥s intermedi√°rias): <b>${moeda(entradaRestanteAposInter)}</b></p>
      ` : `
        <p>Intermedi√°rias: <b>N√£o</b></p>
        <p>Saldo para mensais: <b>${moeda(entradaRestanteAposInter)}</b></p>
      `}

      <div class="divider"></div>

      <p>Mensais (${parcelasEntrada}x): <b>${moeda(mensalFinal)}</b> <span class="pill">limite 30% renda: ${moeda(mensalMax)}</span></p>

      ${alertaLimite}

      ${saldoPosChaves > 0 ? `
        <p class="alerta">Saldo restante (p√≥s-chaves / a negociar): ${moeda(saldoPosChaves)}</p>
      ` : `
        <p style="color:#0b6e3b; font-weight:700;">‚úÖ Saldo totalmente coberto dentro do limite.</p>
      `}
    `;
  }

  /* ===== C√°lculo Juros de Obra (simples) ===== */
  function calcularJurosObra(){
    const financiamento = limparMoeda(document.getElementById("valorFinanciamento").value);
    const prazoObra = parseInt(document.getElementById("prazoObra").value) || 0;
    const taxa = parseFloat(document.getElementById("taxaJuros").value) || 0;

    const out = document.getElementById("resultadoJuros");

    if(!financiamento || !prazoObra){
      out.innerHTML = `<p class="alerta">Preencha Valor do Financiamento e Prazo da Obra no painel superior.</p>`;
      return;
    }
    if(!taxa){
      out.innerHTML = `<p class="alerta">Para calcular Juros de Obra, informe a Taxa de Juros (% a.a.) no painel superior.</p>`;
      return;
    }

    const jurosMensal = (taxa / 100) / 12;
    const totalEstimado = financiamento * jurosMensal * prazoObra;

    out.innerHTML = `
      <h3 style="margin-top:0;">Resumo do Juros de Obra (estimado)</h3>
      <p>Taxa informada: <b>${taxa.toFixed(2)}% a.a.</b></p>
      <p>Taxa mensal estimada: <b>${(jurosMensal*100).toFixed(3)}% a.m.</b></p>
      <p>Prazo da obra: <b>${prazoObra} meses</b></p>
      <div class="divider"></div>
      <p>Total estimado de juros de obra: <b>${moeda(totalEstimado)}</b></p>
    `;
  }
</script>

</body>
</html>
