<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador Imobili√°rio</title>

<style>
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f6f5;
  color:#222;
}

/* ===== TOPO ===== */
.painel-topo{
  background:#fff;
  border-bottom:1px solid #e0e0e0;
  padding:16px;
}
.painel-topo h1{
  text-align:center;
  color:#0b6e3b;
  margin:0 0 16px;
  font-size:22px;
}
.grid-topo{
  max-width:900px;
  margin:0 auto;
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
.campo label{
  display:block;
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
}
.campo input,.campo select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
}
.campo-full{ grid-column:1/-1; }

@media(min-width:768px){
  .grid-topo{ grid-template-columns:repeat(2,1fr); }
  .grid-imovel{
    grid-column:1/-1;
    display:grid;
    grid-template-columns:2fr 1fr;
    gap:12px;
  }
}

/* ===== CONTAINER ===== */
.container{
  max-width:900px;
  margin:24px auto;
  padding:0 16px 40px;
}

/* ===== BLOCO ===== */
.bloco{
  background:#fff;
  border-radius:14px;
  border:1px solid #ddd;
  margin-bottom:18px;
  overflow:hidden;
}
.bloco-header{
  color:#fff;
  padding:14px 16px;
  font-weight:700;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.header-entrada{ background:#0b6e3b; }
.header-juros{ background:#d97706; }

.toggle-icon{
  background:rgba(255,255,255,0.2);
  border-radius:6px;
  width:22px;
  height:22px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.bloco-conteudo{
  display:none;
  padding:18px;
}

.subgrid{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}
@media(min-width:768px){
  .subgrid{ grid-template-columns:repeat(2,1fr); }
  .span2{ grid-column:1/-1; }
}

.divider{
  height:1px;
  background:#e9e9e9;
  margin:16px 0;
}

/* ===== BOT√ïES ===== */
.btn-entrada{ background:#0b6e3b; }
.btn-juros{ background:#d97706; }
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  color:#fff;
  font-size:15px;
  cursor:pointer;
  margin-top:12px;
}

.btn-limpar{
  background:#e5e7eb;
  color:#333;
  font-size:14px;
  padding:8px;
}
.btn-limpar:hover{ background:#d1d5db; }

/* ===== RESULTADOS ===== */
.resultado{
  background:#f1f7f3;
  padding:16px;
  border-radius:12px;
  margin-bottom:10px;
}
.alerta{
  color:#c62828;
  font-weight:700;
}

/* ===== INTERMEDI√ÅRIAS ===== */
.bloco-inter{ background:#f3faf6; padding:12px; border-radius:10px; }
.inter-list{ display:flex; flex-direction:column; gap:10px; }
.inter-row{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  background:#fff;
  border:1px solid #e6efe9;
  padding:10px;
  border-radius:10px;
}
@media(min-width:768px){
  .inter-row{ grid-template-columns:1fr 1fr; }
}

/* ===== FLUXOS FIXOS ===== */
#fluxoEntrada,#fluxoJuros{
  position:sticky;
  top:10px;
  z-index:5;
}
</style>
</head>

<body>

<!-- ===== TOPO ===== -->
<div class="painel-topo">
  <h1>Simulador Imobili√°rio</h1>
  <div class="grid-topo">

    <div class="grid-imovel">
      <div class="campo">
        <label>üè† Valor do Im√≥vel (R$)</label>
        <input id="valorImovel" oninput="formatarMoeda(this)">
      </div>
      <div class="campo">
        <label>üè¢ Unidade / Bloco / Andar</label>
        <input id="unidade">
      </div>
    </div>

    <div class="campo">
      <label>üè¶ Valor do Financiamento (R$)</label>
      <input id="valorFinanciamento" oninput="formatarMoeda(this)">
    </div>

    <div class="campo">
      <label>üí∞ FGTS (R$)</label>
      <input id="fgts" oninput="formatarMoeda(this)">
    </div>

    <div class="campo campo-full">
      <label>üìÖ Previs√£o de Entrega (m√™s/ano)</label>
      <select id="entregaSelect"></select>
    </div>

  </div>
</div>

<div class="container">

<!-- ===== ENTRADA ===== -->
<div class="bloco">
  <div class="bloco-header header-entrada" onclick="toggleBloco(this)">
    <span>üí∞ Entrada / Fluxo Inicial</span>
    <span class="toggle-icon">+</span>
  </div>

  <div class="bloco-conteudo">

    <div class="subgrid">
      <div class="campo">
        <label>üí∏ Valor do Ato (R$)</label>
        <input id="ato" oninput="formatarMoeda(this)">
      </div>
      <div class="campo">
        <label>üóìÔ∏è MESES / PARCELAS</label>
        <input id="parcelasEntrada" type="number">
      </div>
      <div class="campo span2">
        <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
        <input id="renda" oninput="formatarMoeda(this)">
      </div>
    </div>

    <div class="divider"></div>

    <div class="bloco-inter">
      <div class="campo span2">
        <label>üìä Tem Intermedi√°rias?</label>
        <select id="temInter" onchange="toggleInter()">
          <option value="nao">N√£o</option>
          <option value="sim">Sim</option>
        </select>
      </div>

      <div class="campo" id="boxQtdInter" style="display:none;">
        <label>üî¢ Quantidade de Intermedi√°rias / Anual</label>
        <input id="qtdInter" type="number" oninput="renderInterRows()">
      </div>

      <div class="campo span2" id="boxInterRows" style="display:none;">
        <div class="inter-list" id="interList"></div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- P√ìS-CHAVES -->
    <div class="campo span2">
      <label>üèóÔ∏è Construtora aceita saldo p√≥s-chaves?</label>
      <select id="aceitaPos" onchange="togglePos()">
        <option value="nao">N√£o</option>
        <option value="sim">Sim</option>
      </select>
    </div>

    <div class="subgrid" id="boxPos" style="display:none;">
      <div class="campo">
        <label>% m√°ximo do valor do im√≥vel</label>
        <input id="percPos" type="number">
      </div>
      <div class="campo">
        <label>M√°x. parcelas p√≥s-chaves</label>
        <input id="parcelasPos" type="number">
      </div>
    </div>

    <button class="btn-entrada" onclick="calcularEntrada()">Calcular Entrada</button>
  </div>
</div>

<div id="fluxoEntrada">
  <div id="resultadoEntrada" class="resultado"></div>
  <button class="btn-limpar" onclick="limparEntrada()">Limpar fluxo de entrada</button>
</div>

<!-- ===== JUROS DE OBRA ===== -->
<div class="bloco">
  <div class="bloco-header header-juros" onclick="toggleBloco(this)">
    <span>üèóÔ∏è Juros de Obra</span>
    <span class="toggle-icon">+</span>
  </div>

  <div class="bloco-conteudo">
    <div class="subgrid">
      <div class="campo">
        <label>% da Obra</label>
        <input id="percObra" type="number">
      </div>
      <div class="campo">
        <label>Taxa de Juros Anual (%)</label>
        <input id="jurosAnual" type="number">
      </div>
      <div class="campo">
        <label>TR (%) <small>‚Äì m√©dia 0,17%</small></label>
        <input id="tr" type="number" value="0.17">
      </div>
      <div class="campo">
        <label>Taxas e Seguros (R$) <small>‚Äì m√©dia R$ 65</small></label>
        <input id="taxas" value="R$ 65,00" oninput="formatarMoeda(this)">
      </div>
    </div>

    <button class="btn-juros" onclick="calcularJuros()">Calcular Juros de Obra</button>
  </div>
</div>

<div id="fluxoJuros">
  <div id="resultadoJuros" class="resultado"></div>
  <button class="btn-limpar" onclick="limparJuros()">Limpar juros de obra</button>
</div>

</div>

<script>
function formatarMoeda(c){
  let v=(c.value||"").replace(/\D/g,"");
  if(!v){ c.value=""; return; }
  v=(parseInt(v)/100).toFixed(2).replace(".",",");
  v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
  c.value="R$ "+v;
}
function limpar(v){
  return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", "."))||0;
}
function moeda(n){
  return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}
function gerarMesAno(){
  const h=new Date(), arr=[];
  const m=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
  for(let i=0;i<48;i++){
    const d=new Date(h.getFullYear(),h.getMonth()+i,1);
    arr.push(`${m[d.getMonth()]}/${String(d.getFullYear()).slice(-2)}`);
  }
  return arr;
}
(function(){
  const sel=document.getElementById("entregaSelect");
  gerarMesAno().forEach(t=>{
    const o=document.createElement("option");
    o.textContent=t;
    sel.appendChild(o);
  });
})();

function toggleBloco(el){
  const c=el.nextElementSibling;
  const i=el.querySelector(".toggle-icon");
  const aberto=c.style.display==="block";
  c.style.display=aberto?"none":"block";
  i.textContent=aberto?"+":"‚Äì";
}

/* ===== ENTRADA ===== */
function toggleInter(){
  const sim=temInter.value==="sim";
  boxQtdInter.style.display=sim?"block":"none";
  boxInterRows.style.display=sim?"block":"none";
  if(!sim){
    qtdInter.value="";
    interList.innerHTML="";
  }
}
function renderInterRows(){
  const q=parseInt(qtdInter.value)||0;
  interList.innerHTML="";
  const meses=gerarMesAno();
  for(let i=1;i<=q;i++){
    const r=document.createElement("div");
    r.className="inter-row";
    r.innerHTML=`
      <div><label>${i}¬™ Intermedi√°ria / Anual</label><select>${meses.map(m=>`<option>${m}</option>`).join("")}</select></div>
      <div><label>Valor (R$)</label><input oninput="formatarMoeda(this)"></div>`;
    interList.appendChild(r);
  }
}
function togglePos(){
  boxPos.style.display=aceitaPos.value==="sim"?"grid":"none";
}

function calcularEntrada(){
  const im=limpar(valorImovel.value),
        fi=limpar(valorFinanciamento.value),
        fg=limpar(fgts.value),
        at=limpar(ato.value),
        re=limpar(renda.value),
        p=parseInt(parcelasEntrada.value)||0;

  if(!im||!fi||!re||!p){
    resultadoEntrada.innerHTML="<p class='alerta'>Preencha os campos obrigat√≥rios.</p>";
    return;
  }

  const entrada=im-fi-fg;
  let saldo=entrada-at;

  const inter=[];
  if(temInter.value==="sim"){
    document.querySelectorAll("#interList input").forEach(i=>{
      inter.push(limpar(i.value)||re);
    });
  }
  inter.forEach(v=>saldo-=v);

  let mensal=saldo/p;
  let resto=0;
  if(mensal>re*0.3){
    mensal=re*0.3;
    resto=saldo-(mensal*p);
  }

  resultadoEntrada.innerHTML=`
    <h3>Fluxo de Pagamento ‚Äì Entrada</h3>
    <p>üìÖ Previs√£o de entrega: <b>${entregaSelect.value}</b></p>
    <p>Entrada total: <b>${moeda(entrada)}</b></p>
    <div class="divider"></div>
    <p>Ato: <b>${moeda(at)}</b></p>
    ${inter.length?`<p>Intermedi√°rias (${inter.length}x): <b>${moeda(inter[0])}</b></p>`:""}
    <p>Mensais (${p}x): <b>${moeda(mensal)}</b></p>
    ${resto>0?`<p class="alerta">Saldo restante: ${moeda(resto)}</p>`:""}
  `;
}
function limparEntrada(){ resultadoEntrada.innerHTML=""; }

/* ===== JUROS ===== */
function calcularJuros(){
  const financiamento=limpar(valorFinanciamento.value),
        perc=parseFloat(percObra.value)||0,
        juros=parseFloat(jurosAnual.value)||0,
        trVal=parseFloat(tr.value)||0,
        taxasVal=limpar(taxas.value);

  if(!financiamento||!perc||!juros){
    resultadoJuros.innerHTML="<p class='alerta'>Preencha os campos obrigat√≥rios.</p>";
    return;
  }

  const liberado=financiamento*(perc/100);
  const parcela=(liberado*((juros/100)/12))+(liberado*(trVal/100))+taxasVal;

  resultadoJuros.innerHTML=`
    <h3>Juros de Obra (Estimativa)</h3>
    <p>Percentual da obra considerado: <b>${perc}%</b></p>
    <p>Parcela estimada mensal: <b>${moeda(parcela)}</b></p>
    <em>Valor aproximado para fins de simula√ß√£o. Pode variar conforme TR mensal e pol√≠ticas do banco.</em>
  `;
}
function limparJuros(){ resultadoJuros.innerHTML=""; }
</script>

</body>
</html>
