<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulador Imobili√°rio</title>

<style>
  * { box-sizing: border-box; }
  body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    background:#f4f6f5;
    color:#222;
  }

  /* ===== TOPO ===== */
  .painel-topo{
    background:#fff;
    border-bottom:1px solid #e0e0e0;
    padding:16px;
  }
  .painel-topo h1{
    text-align:center;
    color:#0b6e3b;
    margin:0 0 16px;
    font-size:22px;
  }
  .grid-topo{
    max-width:900px;
    margin:0 auto;
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }
  .campo label{
    display:block;
    font-size:13px;
    font-weight:600;
    margin-bottom:6px;
  }
  .campo input,.campo select{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:15px;
  }
  .campo-full{ grid-column:1/-1; }

  @media(min-width:768px){
    .grid-topo{ grid-template-columns:repeat(2,1fr); }
    .grid-imovel{
      grid-column:1/-1;
      display:grid;
      grid-template-columns:2fr 1fr;
      gap:12px;
    }
  }

  /* ===== CONTAINER ===== */
  .container{
    max-width:900px;
    margin:24px auto;
    padding:0 16px 40px;
  }

  /* ===== BLOCO (ACCORDION) ===== */
  .bloco{
    background:#fff;
    border-radius:14px;
    border:1px solid #ddd;
    overflow:hidden;
    margin-bottom:14px; /* mais ‚Äúcolado‚Äù, sem buracos */
  }
  .bloco-header{
    color:#fff;
    padding:14px 16px;
    font-weight:700;
    cursor:pointer;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .header-entrada{ background:#0b6e3b; }
  .header-juros{ background:#d97706; }

  .toggle-icon{
    background:rgba(255,255,255,0.2);
    border-radius:6px;
    width:22px;
    height:22px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
  }
  .bloco-conteudo{
    display:none;
    padding:18px;
  }

  .subgrid{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }
  @media(min-width:768px){
    .subgrid{ grid-template-columns:repeat(2,1fr); }
    .span2{ grid-column:1/-1; }
  }

  .divider{
    height:1px;
    background:#e9e9e9;
    margin:16px 0;
  }

  /* ===== SE√á√ïES VISUAIS ===== */
  .bloco-inter{ background:#f3faf6; padding:12px; border-radius:10px; }
  .bloco-pos{ background:#f2f6fb; padding:12px; border-radius:10px; }

  /* ===== BOT√ïES ===== */
  .btn-entrada{ background:#0b6e3b; }
  .btn-juros{ background:#d97706; }
  button{
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    color:#fff;
    font-size:15px;
    cursor:pointer;
    margin-top:12px;
  }

  /* ===== RESULTADOS ===== */
  .resultado{
    display:none;          /* s√≥ aparece quando calculado */
    background:#f1f7f3;
    padding:16px;
    border-radius:12px;
    margin:10px 0 0;       /* sem espa√ßo gigante */
  }
  .alerta{
    color:#c62828;
    font-weight:700;
  }
  .obs{
    font-style:italic;
    color:#444;
    margin-top:10px;
    display:block;
  }

  /* ===== LIMPAR (pequeno, central, vermelho, s√≥ quando calculado) ===== */
  .box-limpar{
    display:none;           /* s√≥ aparece quando calculado */
    text-align:center;
    margin:10px 0 18px;
  }
  .btn-limpar{
    width:auto;
    display:inline-block;
    background:#c62828;
    color:#fff;
    font-size:13px;
    padding:8px 16px;
    border-radius:999px;
    border:none;
    cursor:pointer;
  }
  .btn-limpar:hover{ background:#b71c1c; }

  /* ===== INTERMEDI√ÅRIAS LIST ===== */
  .inter-list{ display:flex; flex-direction:column; gap:10px; }
  .inter-row{
    display:grid;
    grid-template-columns:1fr;
    gap:10px;
    background:#fff;
    border:1px solid #e6efe9;
    padding:10px;
    border-radius:10px;
  }
  @media(min-width:768px){
    .inter-row{ grid-template-columns:1fr 1fr; }
  }
</style>
</head>

<body>

<!-- ===== TOPO ===== -->
<div class="painel-topo">
  <h1>Simulador Imobili√°rio</h1>
  <div class="grid-topo">

    <div class="grid-imovel">
      <div class="campo">
        <label>üè† Valor do Im√≥vel (R$)</label>
        <input id="valorImovel" oninput="formatarMoeda(this)">
      </div>
      <div class="campo">
        <label>üè¢ Unidade / Bloco / Andar</label>
        <input id="unidade">
      </div>
    </div>

    <div class="campo">
      <label>üè¶ Valor do Financiamento (R$)</label>
      <input id="valorFinanciamento" oninput="formatarMoeda(this)">
    </div>

    <div class="campo">
      <label>üí∞ FGTS (R$)</label>
      <input id="fgts" oninput="formatarMoeda(this)">
    </div>

    <div class="campo campo-full">
      <label>üìÖ Previs√£o de Entrega (m√™s/ano)</label>
      <select id="entregaSelect"></select>
    </div>

  </div>
</div>

<div class="container">

  <!-- ===== ENTRADA ===== -->
  <div class="bloco">
    <div class="bloco-header header-entrada" onclick="toggleBloco(this)">
      <span>üí∞ Entrada / Fluxo Inicial</span>
      <span class="toggle-icon">+</span>
    </div>

    <div class="bloco-conteudo">

      <div class="subgrid">
        <div class="campo">
          <label>üí∏ Valor do Ato (R$)</label>
          <input id="ato" oninput="formatarMoeda(this)">
        </div>

        <div class="campo">
          <label>üóìÔ∏è MESES / PARCELAS</label>
          <input id="parcelasEntrada" type="number" min="1">
        </div>

        <div class="campo span2">
          <label>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Renda Familiar Mensal (R$)</label>
          <input id="renda" oninput="formatarMoeda(this)">
        </div>
      </div>

      <div class="divider"></div>

      <!-- INTERMEDI√ÅRIAS -->
      <div class="bloco-inter">
        <div class="subgrid">
          <div class="campo">
            <label>üìä Tem Intermedi√°rias?</label>
            <select id="temInter" onchange="toggleInter()">
              <option value="nao">N√£o</option>
              <option value="sim">Sim</option>
            </select>
          </div>

          <div class="campo" id="boxQtdInter" style="display:none;">
            <label>üî¢ Quantidade de Intermedi√°rias / Anual</label>
            <input id="qtdInter" type="number" min="1" oninput="renderInterRows()">
          </div>

          <div class="campo span2" id="boxInterRows" style="display:none;">
            <div class="inter-list" id="interList"></div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- P√ìS-CHAVES -->
      <div class="bloco-pos">
        <div class="subgrid">
          <div class="campo span2">
            <label>üèóÔ∏è Construtora aceita saldo p√≥s-chaves?</label>
            <select id="aceitaPos" onchange="togglePos()">
              <option value="nao">N√£o</option>
              <option value="sim">Sim</option>
            </select>
          </div>

          <div class="campo" id="boxPosPerc" style="display:none;">
            <label>% m√°ximo do valor do im√≥vel</label>
            <input id="percPos" type="number" min="0" step="0.1">
          </div>

          <div class="campo" id="boxPosParc" style="display:none;">
            <label>M√°x. parcelas p√≥s-chaves</label>
            <input id="parcelasPos" type="number" min="1">
          </div>
        </div>
      </div>

      <button class="btn-entrada" onclick="calcularEntrada()">Calcular Entrada</button>
    </div>
  </div>

  <!-- RESULTADO ENTRADA -->
  <div id="resultadoEntrada" class="resultado"></div>
  <div id="limparEntradaBox" class="box-limpar">
    <button class="btn-limpar" onclick="limparEntrada()">Limpar fluxo de entrada</button>
  </div>

  <!-- ===== JUROS DE OBRA ===== -->
  <div class="bloco">
    <div class="bloco-header header-juros" onclick="toggleBloco(this)">
      <span>üèóÔ∏è Juros de Obra</span>
      <span class="toggle-icon">+</span>
    </div>

    <div class="bloco-conteudo">
      <div class="subgrid">
        <div class="campo">
          <label>% da Obra</label>
          <input id="percObra" type="number" min="0" step="0.1">
        </div>

        <div class="campo">
          <label>Taxa de Juros Anual (%)</label>
          <input id="jurosAnual" type="number" min="0" step="0.01">
        </div>

        <div class="campo">
          <label>TR (%) <small>‚Äì valor m√©dio 0,17%</small></label>
          <input id="tr" type="number" step="0.001" value="0.17">
        </div>

        <div class="campo">
          <label>Taxas e Seguros (R$) <small>‚Äì usado valor m√©dio R$ 65</small></label>
          <input id="taxas" value="R$ 65,00" oninput="formatarMoeda(this)">
        </div>
      </div>

      <button class="btn-juros" onclick="calcularJuros()">Calcular Juros de Obra</button>
    </div>
  </div>

  <!-- RESULTADO JUROS -->
  <div id="resultadoJuros" class="resultado"></div>
  <div id="limparJurosBox" class="box-limpar">
    <button class="btn-limpar" onclick="limparJuros()">Limpar juros de obra</button>
  </div>

</div>

<script>
  // ===== Helpers =====
  function formatarMoeda(c){
    let v=(c.value||"").replace(/\D/g,"");
    if(!v){ c.value=""; return; }
    v=(parseInt(v)/100).toFixed(2).replace(".",",");
    v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
    c.value="R$ "+v;
  }
  function limparMoeda(v){
    return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", "."))||0;
  }
  function moeda(n){
    return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  }
  function gerarMesAno(){
    const h=new Date(), arr=[];
    const m=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
    for(let i=0;i<48;i++){
      const d=new Date(h.getFullYear(),h.getMonth()+i,1);
      arr.push(`${m[d.getMonth()]}/${String(d.getFullYear()).slice(-2)}`);
    }
    return arr;
  }
  (function(){
    const sel=document.getElementById("entregaSelect");
    gerarMesAno().forEach(t=>{
      const o=document.createElement("option");
      o.textContent=t;
      sel.appendChild(o);
    });
  })();

  // ===== Accordion =====
  function toggleBloco(el){
    const c=el.nextElementSibling;
    const i=el.querySelector(".toggle-icon");
    const aberto=c.style.display==="block";
    c.style.display=aberto?"none":"block";
    i.textContent=aberto?"+":"‚Äì";
  }

  // ===== Intermedi√°rias =====
  function toggleInter(){
    const sim=document.getElementById("temInter").value==="sim";
    document.getElementById("boxQtdInter").style.display=sim?"block":"none";
    document.getElementById("boxInterRows").style.display=sim?"block":"none";
    if(!sim){
      document.getElementById("qtdInter").value="";
      document.getElementById("interList").innerHTML="";
    }
  }

  function renderInterRows(){
    const q=parseInt(document.getElementById("qtdInter").value)||0;
    const interList=document.getElementById("interList");
    interList.innerHTML="";
    if(q<=0) return;

    const meses=gerarMesAno();
    for(let i=1;i<=q;i++){
      const r=document.createElement("div");
      r.className="inter-row";
      r.innerHTML=`
        <div>
          <label>${i}¬™ Intermedi√°ria / Anual</label>
          <select>${meses.map(m=>`<option>${m}</option>`).join("")}</select>
        </div>
        <div>
          <label>Valor (R$)</label>
          <input oninput="formatarMoeda(this)">
        </div>`;
      interList.appendChild(r);
    }
  }

  // ===== P√≥s-chaves =====
  function togglePos(){
    const sim=document.getElementById("aceitaPos").value==="sim";
    document.getElementById("boxPosPerc").style.display=sim?"block":"none";
    document.getElementById("boxPosParc").style.display=sim?"block":"none";
    if(!sim){
      document.getElementById("percPos").value="";
      document.getElementById("parcelasPos").value="";
    }
  }

  // ===== C√°lculo Entrada =====
  function calcularEntrada(){
    const im=limparMoeda(document.getElementById("valorImovel").value);
    const fi=limparMoeda(document.getElementById("valorFinanciamento").value);
    const fg=limparMoeda(document.getElementById("fgts").value);
    const at=limparMoeda(document.getElementById("ato").value);
    const re=limparMoeda(document.getElementById("renda").value);
    const p=parseInt(document.getElementById("parcelasEntrada").value)||0;

    const out=document.getElementById("resultadoEntrada");
    const btnBox=document.getElementById("limparEntradaBox");

    // obrigat√≥rios
    if(!im || !fi || !re || !p){
      out.style.display="block";
      btnBox.style.display="none";
      out.innerHTML = `<p class="alerta">Preencha os campos obrigat√≥rios (Im√≥vel, Financiamento, Renda e Meses/Parcelas).</p>`;
      return;
    }

    // Entrada total
    const entrada = im - fi - fg;
    let saldo = entrada - at;

    // Intermedi√°rias (valores individuais)
    const interVals = [];
    const temInter = document.getElementById("temInter").value === "sim";
    if(temInter){
      document.querySelectorAll("#interList input").forEach(inp=>{
        const v = limparMoeda(inp.value);
        interVals.push(v>0 ? v : re); // se vazio, usa 100% da renda
      });
    }
    interVals.forEach(v=> saldo -= v);

    // Mensais (limite 30% renda)
    let mensal = saldo / p;
    let resto = 0;
    const limiteMensal = re * 0.30;

    if(mensal > limiteMensal){
      mensal = limiteMensal;
      resto = saldo - (mensal * p);
    }

    // P√≥s-chaves (se sobrou resto)
    let posTexto = "";
    let alertTexto = "";

    if(resto > 0){
      const aceitaPos = document.getElementById("aceitaPos").value === "sim";
      if(aceitaPos){
        const percPos = parseFloat(document.getElementById("percPos").value)||0;
        const parcelasPos = parseInt(document.getElementById("parcelasPos").value)||0;
        const maxPos = im * (percPos/100);

        if(percPos<=0 || parcelasPos<=0){
          alertTexto = `<p class="alerta">Sobrou saldo: ${moeda(resto)}. Para usar p√≥s-chaves, preencha % m√°ximo e m√°x. parcelas.</p>`;
        } else if(resto <= maxPos){
          const posParcela = resto / parcelasPos;
          posTexto = `<p>P√≥s-chaves (${parcelasPos}x): <b>${moeda(posParcela)}</b></p>`;
          // saldo coberto via p√≥s-chaves ‚Üí zera alerta
          resto = 0;
        } else {
          alertTexto = `<p class="alerta">Sobrou saldo: ${moeda(resto)}. P√≥s-chaves aceita at√© ${moeda(maxPos)} (${percPos}% do im√≥vel). N√£o cobre o saldo.</p>`;
        }
      } else {
        alertTexto = `<p class="alerta">Sobrou saldo: ${moeda(resto)}. Entrada n√£o cobre dentro do limite e n√£o h√° p√≥s-chaves.</p>`;
      }
    }

    // Texto intermedi√°rias (mostrar 1 valor se iguais, sen√£o lista)
    let interTexto = "";
    if(interVals.length){
      const iguais = interVals.every(v => v === interVals[0]);
      if(iguais){
        interTexto = `<p>Intermedi√°rias (${interVals.length}x): <b>${moeda(interVals[0])}</b></p>`;
      } else {
        interTexto = `<p>Intermedi√°rias (${interVals.length}x): <b>${interVals.map(v=>moeda(v)).join(" | ")}</b></p>`;
      }
    }

    out.innerHTML = `
      <h3>Fluxo de Pagamento ‚Äì Entrada</h3>
      <p>üìÖ Previs√£o de entrega: <b>${document.getElementById("entregaSelect").value}</b></p>
      <p>Entrada total: <b>${moeda(entrada)}</b></p>
      <div class="divider"></div>
      <p>Ato: <b>${moeda(at)}</b></p>
      ${interTexto}
      <p>Mensais (${p}x): <b>${moeda(mensal)}</b></p>
      ${posTexto}
      ${alertTexto}
    `;

    out.style.display = "block";
    btnBox.style.display = "block";
  }

  function limparEntrada(){
    document.getElementById("resultadoEntrada").style.display="none";
    document.getElementById("resultadoEntrada").innerHTML="";
    document.getElementById("limparEntradaBox").style.display="none";
  }

  // ===== C√°lculo Juros de Obra =====
  function calcularJuros(){
    const financiamento = limparMoeda(document.getElementById("valorFinanciamento").value);
    const perc = parseFloat(document.getElementById("percObra").value)||0;
    const juros = parseFloat(document.getElementById("jurosAnual").value)||0;
    const trVal = parseFloat(document.getElementById("tr").value)||0;
    const taxas = limparMoeda(document.getElementById("taxas").value);

    const out = document.getElementById("resultadoJuros");
    const btnBox = document.getElementById("limparJurosBox");

    if(!financiamento || !perc || !juros){
      out.style.display="block";
      btnBox.style.display="none";
      out.innerHTML = `<p class="alerta">Preencha os campos obrigat√≥rios (% da obra, juros anual e financiamento no cabe√ßalho).</p>`;
      return;
    }

    const liberado = financiamento * (perc/100);
    const jurosMensal = (juros/100)/12;
    const trMensal = (trVal/100);

    const parcela = (liberado*jurosMensal) + (liberado*trMensal) + taxas;

    out.innerHTML = `
      <h3>Juros de Obra (Estimativa)</h3>
      <p>Percentual da obra considerado: <b>${perc}%</b></p>
      <p>Parcela estimada mensal: <b>${moeda(parcela)}</b></p>
      <span class="obs">Valor aproximado para fins de simula√ß√£o. Pode variar conforme TR mensal e pol√≠ticas do banco.</span>
    `;

    out.style.display="block";
    btnBox.style.display="block";
  }

  function limparJuros(){
    document.getElementById("resultadoJuros").style.display="none";
    document.getElementById("resultadoJuros").innerHTML="";
    document.getElementById("limparJurosBox").style.display="none";
  }
</script>

</body>
</html>
