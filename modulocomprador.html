<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulador Imobili√°rio ‚Äî M√≥dulo Comprador</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Inter',Arial,sans-serif;background:#f5f7fa;color:#222;line-height:1.5;}
header{background:linear-gradient(135deg,#0b6e3b,#0f9b50);color:#fff;text-align:center;padding:28px 18px;box-shadow:0 3px 12px rgba(0,0,0,0.08);}
header h1{font-size:24px;font-weight:700;}
header p{opacity:.9;font-size:15px;margin-top:6px;}
main{max-width:980px;margin:28px auto;background:#fff;padding:26px;border-radius:18px;box-shadow:0 4px 20px rgba(0,0,0,0.05);}
h3.section-title{color:#0b6e3b;margin-bottom:14px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;}
.campo label{font-weight:600;font-size:13px;margin-bottom:6px;display:block;}
.campo input,.campo select{width:100%;padding:10px 12px;border:1px solid #ccc;border-radius:10px;font-size:15px;}
.box{border:1px solid #e6efe9;border-radius:14px;padding:18px;background:#f9fafb;margin-bottom:18px;}
.btn{background:#0b6e3b;color:#fff;border:none;border-radius:10px;padding:12px 24px;cursor:pointer;font-size:16px;font-weight:600;transition:background .2s;}
.btn:hover{background:#0f9b50;}
#boxDiagnostico{margin-top:30px;padding:28px;border-radius:16px;background:linear-gradient(180deg,#fdfdfd,#f7fafc);border:1px solid #e0e5ea;box-shadow:0 2px 12px rgba(0,0,0,0.04);}
#diagnosticoConteudo{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-top:10px;}
.card-dash{background:#fff;border:1px solid #e5e9ed;border-radius:12px;padding:16px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,0.03);}
.card-dash span{display:block;font-size:13px;color:#666;margin-bottom:6px;}
.card-dash strong{font-size:18px;color:#0b6e3b;}
#boxSimulacoes{text-align:center;margin-top:26px;}
.sim-btn{margin:6px;padding:12px 18px;border:1px solid #d5dce0;border-radius:10px;background:#fff;cursor:pointer;font-weight:600;color:#333;transition:all .2s;}
.sim-btn:hover{background:#0b6e3b;color:#fff;border-color:#0b6e3b;}
#simEntradaBox{display:none;margin-top:30px;padding:28px;border-radius:14px;background:#f9fafb;border:1px solid #e0e5ea;}
.result-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;margin-top:18px;}
.result-card{background:#fff;border:1px solid #e6e6e6;border-radius:10px;padding:14px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,0.03);}
.result-card span{display:block;font-size:13px;color:#777;margin-bottom:4px;}
.result-card strong{font-size:17px;color:#0b6e3b;}
</style>
</head>

<body>
<header>
  <h1>Simulador Imobili√°rio ‚Äî Comprador</h1>
  <p>Descubra quanto voc√™ pode financiar e simule o valor do im√≥vel desejado.</p>
</header>

<main>
  <!-- CABE√áALHO DO COMPRADOR -->
  <div class="box">
    <h3 class="section-title">üë§ Sobre quem pretende adquirir o im√≥vel</h3>
    <div class="grid">
      <div class="campo">
        <label>Pretende adquirir sozinho(a) ou com algu√©m?</label>
        <select id="compraCom" onchange="onChangeComposicao()">
          <option value="">Selecione...</option>
          <option value="sozinho">Sozinho(a)</option>
          <option value="namorado">Com namorado(a)</option>
          <option value="noivo">Com noivo(a)</option>
          <option value="conjuge">Com c√¥njuge</option>
          <option value="familiar">Com familiar</option>
        </select>
      </div>

      <div class="campo" id="boxIdade1" style="display:none;">
        <label>üéÇ Idade do comprador 1</label>
        <input id="idade1" type="number" min="18" max="99" />
      </div>

      <div class="campo" id="boxRenda1" style="display:none;">
        <label>üí∞ Renda mensal do comprador 1</label>
        <input id="renda1" oninput="formatarMoeda(this)" />
      </div>

      <div class="campo" id="boxIdade2" style="display:none;">
        <label>üéÇ Idade do comprador 2</label>
        <input id="idade2" type="number" min="18" max="99" />
      </div>

      <div class="campo" id="boxRenda2" style="display:none;">
        <label>üí∞ Renda mensal do comprador 2</label>
        <input id="renda2" oninput="formatarMoeda(this)" />
      </div>

      <div class="campo" id="boxEstado" style="display:none;">
        <label>üìç Em qual estado ser√° o lan√ßamento?</label>
        <select id="estado" onchange="onEstadoSelecionado()">
          <option value="">Selecione...</option>
          <option>CE</option><option>SP</option><option>RJ</option><option>MG</option>
          <option>BA</option><option>PE</option><option>PR</option><option>SC</option>
          <option>RS</option><option>GO</option><option>DF</option>
        </select>
      </div>
    </div>
  </div>

  <div class="box" id="boxProf" style="display:none;">
    <h3 class="section-title">üíº Renda e FGTS</h3>
    <div class="grid">
      <div class="campo" id="boxSing" style="display:none;">
        <label>Voc√™ trabalha como:</label>
        <select id="tipoSing" onchange="onTipo()">
          <option value="">Selecione...</option>
          <option value="clt3">CLT (h√° mais de 3 anos)</option>
          <option value="outro">CLT &lt; 3 anos / PJ / Aut√¥nomo</option>
        </select>
      </div>
      <div class="campo" id="boxPlur" style="display:none;">
        <label>Na composi√ß√£o, algu√©m √© CLT h√° mais de 3 anos?</label>
        <select id="tipoPlur" onchange="onTipo()">
          <option value="">Selecione...</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
      </div>
      <div class="campo" id="boxFgts" style="display:none;">
        <label>üí∞ Vai utilizar FGTS?</label>
        <select id="usaFgts" onchange="toggleFgts()">
          <option value="">Selecione...</option>
          <option value="nao">N√£o</option>
          <option value="sim">Sim</option>
        </select>
      </div>
      <div class="campo" id="boxFgtsVal" style="display:none;">
        <label>üí∞ Valor estimado do FGTS</label>
        <input id="fgtsVal" oninput="formatarMoeda(this)" />
      </div>
      <div class="campo" id="boxCap" style="display:none;">
        <label>Possui algum valor guardado para entrada?</label>
        <select id="temGuardado" onchange="mostrarDiagnosticoBtn()">
          <option value="">Selecione...</option>
          <option value="nao">N√£o</option>
          <option value="sim">Sim</option>
        </select>
      </div>
      <div class="campo" id="boxGuardado" style="display:none;">
        <label>üí∏ Valor guardado</label>
        <input id="valorGuardado" oninput="formatarMoeda(this)" />
      </div>
    </div>
  </div>

  <div id="boxAcao" style="display:none;text-align:center;">
    <button class="btn" id="btnDiagnostico">Gerar Diagn√≥stico</button>
  </div>

  <!-- DIAGN√ìSTICO -->
  <div id="boxDiagnostico" style="display:none;">
    <h3 class="section-title">üßæ Diagn√≥stico Financeiro</h3>
    <div id="diagnosticoConteudo"></div>
  </div>

  <!-- SIMULA√á√ïES -->
  <div id="boxSimulacoes" style="display:none;">
    <button class="sim-btn" onclick="abrirSimulacaoEntrada()">üí∞ Simular Entrada</button>
  </div>

  <!-- SIMULA√á√ÉO DE ENTRADA -->
  <div id="simEntradaBox" style="display:none;">
    <h3 class="section-title">üí∞ Simula√ß√£o de Entrada</h3>
    <div class="grid">
      <div class="campo">
        <label>Valor do im√≥vel pretendido (R$)</label>
        <input id="valorImovel" placeholder="Ex.: 250000" />
      </div>
      <div class="campo">
        <label>Prazo (meses)</label>
        <input id="prazo" type="number" value="420" />
      </div>
      <div class="campo">
        <label>Comprometimento da renda (%)</label>
        <input id="compRenda" type="number" value="30" />
      </div>
    </div>
    <div style="margin-top:20px;text-align:center;">
      <button class="btn" onclick="calcularEntrada()">Calcular</button>
      <button class="btn" style="background:#888;margin-left:6px;" onclick="limparEntrada()">Limpar</button>
    </div>
    <div id="resultadoEntrada" class="result-grid" style="display:none;"></div>
  </div>
</main>

<script>
function formatarMoeda(c){let v=(c.value||"").replace(/\D/g,"");if(!v){c.value="";return;}v=(parseInt(v,10)/100).toFixed(2).replace(".",",");v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");c.value="R$ "+v;}
function limparMoeda(v){return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", ".")) || 0;}

function onChangeComposicao(){
  const c=compraCom.value;const comp=c!=="sozinho";
  boxIdade1.style.display="block";boxRenda1.style.display="block";
  boxIdade2.style.display=comp?"block":"none";
  boxRenda2.style.display=comp?"block":"none";
  boxEstado.style.display="block";
}
function onEstadoSelecionado(){
  boxProf.style.display="block";
  const solo=compraCom.value==="sozinho";
  boxSing.style.display=solo?"block":"none";
  boxPlur.style.display=solo?"none":"block";
}
function onTipo(){
  boxFgts.style.display="block";
}
function toggleFgts(){
  boxFgtsVal.style.display=usaFgts.value==="sim"?"block":"none";
  boxCap.style.display="block";
}
function mostrarDiagnosticoBtn(){
  boxGuardado.style.display=temGuardado.value==="sim"?"block":"none";
  boxAcao.style.display="block";
}

function getRegiao(uf){const ne=["MA","PI","CE","RN","PB","PE","AL","SE","BA"];return ne.includes(uf)?"no_ne":"sul_se_co";}
function getTaxaMCMV(renda,cotista,estado){
  const regiao=getRegiao(estado);let faixa;
  if(renda<=2160)faixa="1A";
  else if(renda<=2850)faixa="1B";
  else if(renda<=3500)faixa="2A";
  else if(renda<=4000)faixa="2B";
  else if(renda<=4700)faixa="2C";
  else if(renda<=8600)faixa="3";
  else faixa="4";
  const tabela={
    "1A":{no_ne:{cot:4.07,nao:4.59},sul_se_co:{cot:4.33,nao:4.85}},
    "1B":{no_ne:{cot:4.33,nao:4.85},sul_se_co:{cot:4.59,nao:5.12}},
    "2A":{no_ne:{cot:4.85,nao:5.39},sul_se_co:{cot:5.12,nao:5.67}},
    "2B":{no_ne:{cot:5.63,nao:6.17},sul_se_co:{cot:5.63,nao:6.17}},
    "2C":{no_ne:{cot:6.69,nao:7.23},sul_se_co:{cot:6.69,nao:7.23}},
    "3":{no_ne:{cot:7.93,nao:8.46},sul_se_co:{cot:7.93,nao:8.46}},
    "4":{no_ne:{cot:11.03,nao:11.03},sul_se_co:{cot:11.03,nao:11.03}}
  };
  const taxa=tabela[faixa][regiao][cotista?"cot":"nao"];
  return {faixa,taxa};
}

function calcularFinanciamentoMaximo(renda,jurosAA){
  const i=(jurosAA/100)/12,n=420,lim=renda*0.3;
  let low=0,high=1500000;
  for(let k=0;k<45;k++){const mid=(low+high)/2;const pmt=(mid*i)/(1-Math.pow(1+i,-n));if(pmt<=lim)low=mid;else high=mid;}
  return low;
}

let rendaTotalGlobal=0;let taxaGlobal=0;

btnDiagnostico.addEventListener("click",()=>{
  const renda1v=limparMoeda(renda1.value);
  const renda2v=limparMoeda(renda2.value);
  const estadoV=estado.value;
  const cotista=(compraCom.value==="sozinho"?tipoSing.value==="clt3":tipoPlur.value==="sim");
  const rendaTotal=renda1v+renda2v;
  rendaTotalGlobal=rendaTotal;
  const {faixa,taxa}=getTaxaMCMV(rendaTotal,cotista,estadoV);
  taxaGlobal=taxa;
  const financiamento=calcularFinanciamentoMaximo(rendaTotal,taxa);
  const tetoImovel=financiamento/0.8;
  diagnosticoConteudo.innerHTML=`
    <div class="card-dash"><span>Faixa MCMV</span><strong>${faixa}</strong></div>
    <div class="card-dash"><span>Taxa de Juros</span><strong>${taxa.toFixed(2)}% a.a.</strong></div>
    <div class="card-dash"><span>Financiamento M√°ximo</span><strong>R$ ${financiamento.toLocaleString("pt-BR",{minimumFractionDigits:2})}</strong></div>
    <div class="card-dash"><span>Valor M√°ximo do Im√≥vel</span><strong>R$ ${tetoImovel.toLocaleString("pt-BR",{minimumFractionDigits:2})}</strong></div>`;
  boxDiagnostico.style.display="block";
  boxSimulacoes.style.display="block";
  boxAcao.style.display="none";
});

function abrirSimulacaoEntrada(){
  simEntradaBox.style.display="block";
  document.getElementById("rendaSimulada")?.remove();
}

function limparEntrada(){
  valorImovel.value="";
  resultadoEntrada.style.display="none";
}

function calcularEntrada(){
  const renda=rendaTotalGlobal;
  const jurosAA=taxaGlobal;
  const valorImovel=parseFloat(valorImovel.value)||0;
  const prazo=parseInt(document.getElementById("prazo").value)||420;
  const comp=parseFloat(document.getElementById("compRenda").value)||30;
  
  const i=(jurosAA/100)/12;
  const parcelaMax=renda*(comp/100);
  let low=0,high=1500000;
  for(let k=0;k<45;k++){
    const mid=(low+high)/2;
    const pmt=(mid*i)/(1-Math.pow(1+i,-prazo));
    if(pmt<=parcelaMax)low=mid;else high=mid;
  }
  const capFinanceira=low;
  const tetoLTV=valorImovel*0.8;
  const financiamentoAprovado=Math.min(capFinanceira,tetoLTV);
  const entradaNecessaria=valorImovel-financiamentoAprovado;
  const pmtReal=(financiamentoAprovado*i)/(1-Math.pow(1+i,-prazo));

  resultadoEntrada.style.display="grid";
  resultadoEntrada.innerHTML=`
    <div class='result-card'><span>Parcela m√°xima permitida (renda)</span><strong>R$ ${parcelaMax.toLocaleString('pt-BR',{minimumFractionDigits:2})}</strong></div>
    <div class='result-card'><span>Parcela estimada do financiamento aprovado</span><strong>R$ ${pmtReal.toLocaleString('pt-BR',{minimumFractionDigits:2})}</strong></div>
    <div class='result-card'><span>Capacidade financeira m√°xima (renda)</span><strong>R$ ${capFinanceira.toLocaleString('pt-BR',{minimumFractionDigits:2})}</strong></div>
    <div class='result-card'><span>Teto por LTV (80%)</span><strong>R$ ${tetoLTV.toLocaleString('pt-BR',{minimumFractionDigits:2})}</strong></div>
    <div class='result-card'><span>Financiamento aprovado</span><strong>R$ ${financiamentoAprovado.toLocaleString('pt-BR',{minimumFractionDigits:2})}</strong></div>
    <div class='result-card'><span>Entrada necess√°ria</span><strong>R$ ${entradaNecessaria.toLocaleString('pt-BR',{minimumFractionDigits:2})}</strong></div>`;
}
</script>
</body>
</html>
