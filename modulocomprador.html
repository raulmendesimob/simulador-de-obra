<!-- =========================
     CABE√áALHO ‚Äî PERFIL DO COMPRADOR
========================= -->
<div class="painel-topo">
  <h1>Simulador Imobili√°rio</h1>

  <div class="grid-topo">

    <!-- =========================
         BLOCO 1 ‚Äî PERFIL
    ========================= -->
    <div class="box-claro campo-full">
      <h3 style="margin:0 0 14px;">üë§ Sobre quem vai comprar</h3>

      <div class="subgrid">
        <div class="campo span2">
          <label>üë• Vai adquirir sozinho(a) ou com algu√©m?</label>
          <select id="compraCom" onchange="onChangeComposicao()">
            <option value="">Selecione...</option>
            <option value="sozinho">Sozinho(a)</option>
            <option value="namorado">Com namorado(a)</option>
            <option value="noivo">Com noivo(a)</option>
            <option value="conjuge">Com c√¥njuge</option>
            <option value="familiar">Com familiar</option>
          </select>
        </div>

        <div class="campo" id="boxRenda" style="display:none;">
          <label id="labelRenda">üí∞ Qual a sua renda mensal?</label>
          <input id="rendaFamiliar" oninput="formatarMoeda(this); onRendaOuEstadoChange();" />
        </div>

        <div class="campo" id="boxEstado" style="display:none;">
          <label id="labelEstado">üìç Em qual estado voc√™ mora?</label>
          <select id="estadoUF" onchange="onRendaOuEstadoChange()">
            <option value="">Selecione...</option>
            <option value="AC">Acre (AC)</option>
            <option value="AL">Alagoas (AL)</option>
            <option value="AP">Amap√° (AP)</option>
            <option value="AM">Amazonas (AM)</option>
            <option value="BA">Bahia (BA)</option>
            <option value="CE">Cear√° (CE)</option>
            <option value="DF">Distrito Federal (DF)</option>
            <option value="ES">Esp√≠rito Santo (ES)</option>
            <option value="GO">Goi√°s (GO)</option>
            <option value="MA">Maranh√£o (MA)</option>
            <option value="MT">Mato Grosso (MT)</option>
            <option value="MS">Mato Grosso do Sul (MS)</option>
            <option value="MG">Minas Gerais (MG)</option>
            <option value="PA">Par√° (PA)</option>
            <option value="PB">Para√≠ba (PB)</option>
            <option value="PR">Paran√° (PR)</option>
            <option value="PE">Pernambuco (PE)</option>
            <option value="PI">Piau√≠ (PI)</option>
            <option value="RJ">Rio de Janeiro (RJ)</option>
            <option value="RN">Rio Grande do Norte (RN)</option>
            <option value="RS">Rio Grande do Sul (RS)</option>
            <option value="RO">Rond√¥nia (RO)</option>
            <option value="RR">Roraima (RR)</option>
            <option value="SC">Santa Catarina (SC)</option>
            <option value="SP">S√£o Paulo (SP)</option>
            <option value="SE">Sergipe (SE)</option>
            <option value="TO">Tocantins (TO)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- =========================
         BLOCO 2 ‚Äî RENDA / FGTS
    ========================= -->
    <div class="box-claro azul campo-full" id="boxProfissional" style="display:none;">
      <h3 style="margin:0 0 14px;">üíº Renda e FGTS</h3>

      <div class="subgrid">
        <div class="campo span2" id="boxTipoSing" style="display:none;">
          <label>Voc√™ trabalha como:</label>
          <select id="tipoProfSing" onchange="onTipoProfChange()">
            <option value="">Selecione...</option>
            <option value="clt_mais_3">CLT (h√° mais de 3 anos)</option>
            <option value="clt_menos_3">CLT (h√° menos de 3 anos)</option>
            <option value="pj">PJ / Aut√¥nomo</option>
          </select>
        </div>

        <div class="campo span2" id="boxTipoPlur" style="display:none;">
          <label>Na composi√ß√£o de renda, pelo menos uma pessoa √© CLT h√° mais de 3 anos?</label>
          <select id="tipoProfPlur" onchange="onTipoProfChange()">
            <option value="">Selecione...</option>
            <option value="sim">Sim</option>
            <option value="nao">N√£o</option>
          </select>
          <div class="obs">
            * Se a resposta for <b>N√£o</b>, o simulador considera <b>n√£o cotista</b> (FGTS n√£o entra nos c√°lculos).
          </div>
        </div>

        <div class="campo" id="boxUsaFgts" style="display:none;">
          <label id="labelFgts">üí∞ Vai utilizar FGTS?</label>
          <select id="usaFgts" onchange="toggleFGTS()">
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo" id="boxFgtsValor" style="display:none;">
          <label>üí∞ Valor estimado de FGTS (R$)</label>
          <input id="fgtsValor" oninput="formatarMoeda(this)" />
        </div>
      </div>
    </div>

    <!-- =========================
         BLOCO 3 ‚Äî CAPACIDADE
    ========================= -->
    <div class="box-claro amarelo campo-full" id="boxGuardado" style="display:none;">
      <h3 style="margin:0 0 14px;">üí∞ Capacidade inicial</h3>

      <div class="subgrid">
        <div class="campo span2">
          <label>Tem dinheiro guardado para usar na entrada?</label>
          <select id="temGuardado" onchange="toggleGuardado()">
            <option value="">Selecione...</option>
            <option value="nao">N√£o</option>
            <option value="sim">Sim</option>
          </select>
        </div>

        <div class="campo" id="boxValorGuardado" style="display:none;">
          <label>üí∏ Quanto voc√™ tem guardado? (R$)</label>
          <input id="valorGuardado" oninput="formatarMoeda(this)" />
        </div>
      </div>
    </div>

    <!-- CAMPOS OCULTOS PARA C√ÅLCULO -->
    <input type="hidden" id="regiaoCalc">
    <input type="hidden" id="cotistaCalc">
    <input type="hidden" id="podeFgtsCalc">

  </div>
</div>

<script>
  function formatarMoeda(c){
    let v=(c.value||"").replace(/\D/g,"");
    if(!v){c.value="";return;}
    v=(parseInt(v,10)/100).toFixed(2).replace(".",",");
    v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
    c.value="R$ "+v;
  }
  function limparMoeda(v){
    return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", "."))||0;
  }

  const UF_NO_NE=new Set(["AC","AP","AM","PA","RO","RR","TO","AL","BA","CE","MA","PB","PE","PI","RN","SE"]);

  function onChangeComposicao(){
    const c=document.getElementById("compraCom").value;
    if(!c)return;

    const isComp=c!=="sozinho";
    document.getElementById("labelRenda").innerText=isComp
      ?"üí∞ Qual a renda mensal familiar? (soma das rendas)"
      :"üí∞ Qual a sua renda mensal?";
    document.getElementById("labelEstado").innerText=isComp
      ?"üìç Em qual estado voc√™s moram?"
      :"üìç Em qual estado voc√™ mora?";
    document.getElementById("labelFgts").innerText=isComp
      ?"üí∞ V√£o utilizar FGTS? (de pelo menos 1)"
      :"üí∞ Vai utilizar FGTS?";

    document.getElementById("boxRenda").style.display="block";
  }

  function onRendaOuEstadoChange(){
    const renda=limparMoeda(document.getElementById("rendaFamiliar").value);
    if(renda>0) document.getElementById("boxEstado").style.display="block";

    const uf=document.getElementById("estadoUF").value;
    if(!uf)return;

    document.getElementById("regiaoCalc").value=UF_NO_NE.has(uf)?"no_ne":"sul_se_co";
    document.getElementById("boxProfissional").style.display="block";

    const c=document.getElementById("compraCom").value;
    document.getElementById("boxTipoSing").style.display=c==="sozinho"?"block":"none";
    document.getElementById("boxTipoPlur").style.display=c!=="sozinho"?"block":"none";
  }

  function onTipoProfChange(){
    const c=document.getElementById("compraCom").value;
    let cotista=false;

    if(c==="sozinho"){
      cotista=document.getElementById("tipoProfSing").value==="clt_mais_3";
    }else{
      cotista=document.getElementById("tipoProfPlur").value==="sim";
    }

    document.getElementById("cotistaCalc").value=cotista?"cotista":"nao_cotista";
    document.getElementById("podeFgtsCalc").value=cotista?"1":"0";

    document.getElementById("boxUsaFgts").style.display=cotista?"block":"none";
    document.getElementById("boxGuardado").style.display="block";
  }

  function toggleFGTS(){
    const usa=document.getElementById("usaFgts").value==="sim";
    document.getElementById("boxFgtsValor").style.display=usa?"block":"none";
  }

  function toggleGuardado(){
    const v=document.getElementById("temGuardado").value;
    document.getElementById("boxValorGuardado").style.display=v==="sim"?"block":"none";
  }
</script>
