<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador Imobili√°rio ‚Äî M√≥dulo Comprador</title>

<style>
/* =========================
   BASE VISUAL / RESET
========================= */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Inter', Arial, sans-serif;
  background: #f5f7fa;
  color: #222;
  line-height: 1.5;
}

/* =========================
   T√çTULO PRINCIPAL
========================= */
header {
  background: linear-gradient(135deg, #0b6e3b, #0f9b50);
  color: #fff;
  text-align: center;
  padding: 28px 18px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.08);
}
header h1 {
  font-size: 24px;
  font-weight: 700;
}
header p {
  opacity: 0.9;
  font-size: 15px;
  margin-top: 6px;
}

/* =========================
   FORM CONTAINER
========================= */
main {
  max-width: 980px;
  margin: 28px auto;
  background: #fff;
  padding: 26px;
  border-radius: 18px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}
h3.section-title {
  color: #0b6e3b;
  margin-bottom: 14px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 14px;
}
.campo label {
  font-weight: 600;
  font-size: 13px;
  margin-bottom: 6px;
  display: block;
}
.campo input, .campo select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 10px;
  font-size: 15px;
}
.box {
  border: 1px solid #e6efe9;
  border-radius: 14px;
  padding: 18px;
  background: #f9fafb;
  margin-bottom: 18px;
}

/* =========================
   BOT√ïES
========================= */
.btn {
  background: #0b6e3b;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 12px 24px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: background 0.2s;
}
.btn:hover { background: #0f9b50; }

/* =========================
   DASHBOARD
========================= */
#boxDiagnostico {
  margin-top: 30px;
  padding: 28px;
  border-radius: 16px;
  background: linear-gradient(180deg,#fdfdfd,#f7fafc);
  border: 1px solid #e0e5ea;
  box-shadow: 0 2px 12px rgba(0,0,0,0.04);
}
#diagnosticoConteudo {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
  gap: 18px;
  margin-top: 10px;
}
.card-dash {
  background: #fff;
  border: 1px solid #e5e9ed;
  border-radius: 12px;
  padding: 16px;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.03);
}
.card-dash span {
  display: block;
  font-size: 13px;
  color: #666;
  margin-bottom: 6px;
}
.card-dash strong {
  font-size: 18px;
  color: #0b6e3b;
}

/* =========================
   BOT√ïES DE SIMULA√á√ÉO
========================= */
#boxSimulacoes {
  display: none;
  margin-top: 26px;
  text-align: center;
}
.sim-btn {
  margin: 6px;
  padding: 12px 18px;
  border: 1px solid #d5dce0;
  border-radius: 10px;
  background: #fff;
  cursor: pointer;
  font-weight: 600;
  color: #333;
  transition: all .2s;
}
.sim-btn:hover {
  background: #0b6e3b;
  color: #fff;
  border-color: #0b6e3b;
}
</style>
</head>

<body>

<header>
  <h1>Simulador Imobili√°rio ‚Äî Comprador</h1>
  <p>Descubra automaticamente quanto voc√™ pode financiar e em qual faixa se enquadra.</p>
</header>

<main>
  <div class="box">
    <h3 class="section-title">üë§ Sobre quem pretende adquirir o im√≥vel</h3>
    <div class="grid">
      <div class="campo">
        <label>Pretende adquirir sozinho(a) ou com algu√©m?</label>
        <select id="compraCom" onchange="onChangeComposicao()">
          <option value="">Selecione...</option>
          <option value="sozinho">Sozinho(a)</option>
          <option value="namorado">Com namorado(a)</option>
          <option value="noivo">Com noivo(a)</option>
          <option value="conjuge">Com c√¥njuge</option>
          <option value="familiar">Com familiar</option>
        </select>
      </div>

      <div class="campo" id="boxIdade1" style="display:none;">
        <label>üéÇ Idade do comprador 1</label>
        <input id="idade1" type="number" min="18" max="99" />
      </div>

      <div class="campo" id="boxRenda1" style="display:none;">
        <label>üí∞ Renda mensal do comprador 1</label>
        <input id="renda1" oninput="formatarMoeda(this)" />
      </div>

      <div class="campo" id="boxIdade2" style="display:none;">
        <label>üéÇ Idade do comprador 2</label>
        <input id="idade2" type="number" min="18" max="99" />
      </div>

      <div class="campo" id="boxRenda2" style="display:none;">
        <label>üí∞ Renda mensal do comprador 2</label>
        <input id="renda2" oninput="formatarMoeda(this)" />
      </div>

      <div class="campo" id="boxEstado" style="display:none;">
        <label>üìç Em qual estado ser√° o lan√ßamento?</label>
        <select id="estado" onchange="onEstadoSelecionado()">
          <option value="">Selecione...</option>
          <option>CE</option><option>SP</option><option>RJ</option>
          <option>MG</option><option>BA</option><option>PE</option>
          <option>PR</option><option>SC</option><option>RS</option>
          <option>GO</option><option>DF</option>
        </select>
      </div>
    </div>
  </div>

  <div class="box" id="boxProf" style="display:none;">
    <h3 class="section-title">üíº Renda e FGTS</h3>
    <div class="grid">
      <div class="campo" id="boxSing" style="display:none;">
        <label>Voc√™ trabalha como:</label>
        <select id="tipoSing" onchange="onTipo()">
          <option value="">Selecione...</option>
          <option value="clt3">CLT (h√° mais de 3 anos)</option>
          <option value="outro">CLT &lt; 3 anos / PJ</option>
        </select>
      </div>
      <div class="campo" id="boxPlur" style="display:none;">
        <label>Na composi√ß√£o, algu√©m √© CLT h√° mais de 3 anos?</label>
        <select id="tipoPlur" onchange="onTipo()">
          <option value="">Selecione...</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
      </div>
      <div class="campo" id="boxCap" style="display:none;">
        <label>Possui algum valor guardado para entrada?</label>
        <select id="temGuardado" onchange="mostrarDiagnosticoBtn()">
          <option value="">Selecione...</option>
          <option value="nao">N√£o</option>
          <option value="sim">Sim</option>
        </select>
      </div>
    </div>
  </div>

  <div id="boxAcao" style="display:none;text-align:center;">
    <button class="btn" id="btnDiagnostico">Gerar Diagn√≥stico</button>
  </div>

  <div id="boxDiagnostico" style="display:none;">
    <h3 class="section-title">üßæ Diagn√≥stico Financeiro</h3>
    <div id="diagnosticoConteudo"></div>
  </div>

  <div id="boxSimulacoes">
    <button class="sim-btn">üí∞ Simular Entrada</button>
    <button class="sim-btn">üìà Simular INCC</button>
    <button class="sim-btn">üèóÔ∏è Simular Juros de Obra</button>
    <button class="sim-btn">üìÑ Gerar PDF</button>
  </div>
</main>

<script>
// === UTILIT√ÅRIOS ===
function formatarMoeda(c){
  let v=(c.value||"").replace(/\D/g,"");
  if(!v){c.value="";return;}
  v=(parseInt(v,10)/100).toFixed(2).replace(".",",");
  v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");
  c.value="R$ "+v;
}
function limparMoeda(v){
  return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", ".")) || 0;
}

// === FLUXO L√ìGICO ===
function onChangeComposicao(){
  const c=compraCom.value;
  const isComp=c!=="sozinho";
  boxIdade1.style.display="block"; boxRenda1.style.display="block";
  boxIdade2.style.display=isComp?"block":"none";
  boxRenda2.style.display=isComp?"block":"none";
  boxEstado.style.display="block";
}
function onEstadoSelecionado(){
  boxProf.style.display="block";
  const solo = compraCom.value==="sozinho";
  boxSing.style.display=solo?"block":"none";
  boxPlur.style.display=solo?"none":"block";
}
function onTipo(){ boxCap.style.display="block"; }
function mostrarDiagnosticoBtn(){ boxAcao.style.display="block"; }

// === DADOS MCMV ===
const MCMV_RANGES = [
  { faixa:"Faixa 1", min:0, max:2160, rate:(cot,reg)=> cot?(reg==="no_ne"?4.07:4.33):(reg==="no_ne"?4.59:4.84) },
  { faixa:"Faixa 1", min:2160.01, max:2850, rate:(cot,reg)=> cot?(reg==="no_ne"?4.33:4.59):(reg==="no_ne"?4.84:5.12) },
  { faixa:"Faixa 2", min:2850.01, max:4700, rate:(cot,reg)=> cot?(reg==="no_ne"?5.64:6.17):(reg==="no_ne"?6.70:7.23) },
  { faixa:"Faixa 3", min:4700.01, max:8600, rate:(cot,reg)=> cot?(reg==="no_ne"?7.93:8.46):(reg==="no_ne"?8.46:8.99) },
  { faixa:"Faixa 4", min:8600.01, max:12000, rate:()=>11.03 }
];
function getRegiao(uf){
  const ne = ["MA","PI","CE","RN","PB","PE","AL","SE","BA"];
  return ne.includes(uf)?"no_ne":"sul_se_co";
}
function findRangeByRenda(r){ return MCMV_RANGES.find(x=>r>=x.min && r<=x.max); }
function calcularFinanciamentoMaximo(renda, jurosAA){
  const i=(jurosAA/100)/12, n=420, lim=renda*0.3;
  let low=0,high=1500000;
  for(let k=0;k<45;k++){
    const mid=(low+high)/2;
    const pmt=(mid*i)/(1-Math.pow(1+i,-n));
    if(pmt<=lim)low=mid; else high=mid;
  }
  return low;
}

// === GERAR DIAGN√ìSTICO ===
btnDiagnostico.addEventListener("click",()=>{
  const renda1v=limparMoeda(renda1.value);
  const renda2v=limparMoeda(renda2.value);
  const idade1v=parseInt(idade1.value)||0;
  const idade2v=parseInt(idade2.value)||0;
  const estadoV=estado.value;
  const cotista=(tipoSing.value==="clt3" || tipoPlur.value==="sim");
  const rendaTotal=renda1v+renda2v;
  const idadeMedia=idade2v>0?(idade1v+idade2v)/2:idade1v;
  const regiao=getRegiao(estadoV);
  const faixa=findRangeByRenda(rendaTotal);
  const taxa=faixa.rate(cotista,regiao);
  const financiamento=calcularFinanciamentoMaximo(rendaTotal,taxa);
  const tetoImovel=financiamento/0.8;
  diagnosticoConteudo.innerHTML=`
    <div class="card-dash"><span>Faixa MCMV</span><strong>${faixa.faixa}</strong></div>
    <div class="card-dash"><span>Taxa de Juros</span><strong>${taxa.toFixed(2)}% a.a.</strong></div>
    <div class="card-dash"><span>Financiamento M√°ximo</span><strong>R$ ${financiamento.toLocaleString("pt-BR",{minimumFractionDigits:2})}</strong></div>
    <div class="card-dash"><span>Valor M√°ximo do Im√≥vel</span><strong>R$ ${tetoImovel.toLocaleString("pt-BR",{minimumFractionDigits:2})}</strong></div>
  `;
  boxDiagnostico.style.display="block";
  boxSimulacoes.style.display="block";
  boxAcao.style.display="none";
});
</script>

</body>
</html>
