<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulador Imobili√°rio ‚Äî M√≥dulo Comprador</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Inter',Arial,sans-serif;background:#f5f7fa;color:#222;line-height:1.5;}
header{background:linear-gradient(135deg,#0b6e3b,#0f9b50);color:#fff;text-align:center;padding:28px 18px;box-shadow:0 3px 12px rgba(0,0,0,0.08);}
header h1{font-size:24px;font-weight:700;}
header p{opacity:.9;font-size:15px;margin-top:6px;}
main{max-width:980px;margin:28px auto;background:#fff;padding:26px;border-radius:18px;box-shadow:0 4px 20px rgba(0,0,0,0.05);}
h3.section-title{color:#0b6e3b;margin-bottom:14px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;}
.campo label{font-weight:600;font-size:13px;margin-bottom:6px;display:block;}
.campo input,.campo select{width:100%;padding:10px 12px;border:1px solid #ccc;border-radius:10px;font-size:15px;}
.box{border:1px solid #e6efe9;border-radius:14px;padding:18px;background:#f9fafb;margin-bottom:18px;}
.btn{background:#0b6e3b;color:#fff;border:none;border-radius:10px;padding:12px 24px;cursor:pointer;font-size:16px;font-weight:600;transition:background .2s;}
.btn:hover{background:#0f9b50;}
.btn-danger{background:#b02a37;color:#fff;}
.btn-danger:hover{background:#8a1f2b;}
.btn-large{width:60%;padding:18px;font-size:18px;border-radius:12px;background:#0b6e3b;color:#fff;font-weight:600;cursor:pointer;transition:all .2s;}
.btn-large:hover{background:#0f9b50;}
#diagnosticoContainer{display:none;margin-top:30px;padding:28px;border-radius:16px;background:#e6f3ff;border:1px solid #c6e0f5;}
#diagnosticoConteudo{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;}
.card-blue{background:#fff;border:1px solid #bcd7f2;border-radius:12px;padding:16px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,0.03);}
.card-blue span{display:block;font-size:13px;color:#555;margin-bottom:6px;}
.card-blue strong{font-size:18px;color:#064d8a;}
#estimativaContainer{display:none;margin-top:30px;padding:28px;border-radius:16px;background:#fdfdfd;border:1px solid #e1e1e1;}
#estimativaContainer h3{color:#0b6e3b;margin-bottom:16px;}
#boxValorImovel{display:none;margin-top:18px;}
.result-table{width:100%;border-collapse:collapse;margin-top:20px;}
.result-table th,.result-table td{border:1px solid #ddd;padding:10px;text-align:center;}
.result-table th{background:#e0f2e9;}
.result-table td strong{color:#0b6e3b;}
</style>
</head>

<body>
<header>
  <h1>Simulador Imobili√°rio ‚Äî Comprador</h1>
  <p>Descubra quanto voc√™ pode financiar e estime sua entrada.</p>
</header>

<main>
  <!-- Cabe√ßalho -->
  <div class="box">
    <h3 class="section-title">üë§ Identifica√ß√£o do(s) Comprador(es)</h3>
    <div class="grid">
      <div class="campo">
        <label>Pretende adquirir sozinho(a) ou com algu√©m?</label>
        <select id="compraCom" onchange="onChangeComposicao()">
          <option value="">Selecione...</option>
          <option value="sozinho">Sozinho(a)</option>
          <option value="namorado">Com namorado(a)</option>
          <option value="noivo">Com noivo(a)</option>
          <option value="conjuge">Com c√¥njuge</option>
          <option value="familiar">Com familiar</option>
        </select>
      </div>

      <!-- Comprador 1 -->
      <div class="campo" id="boxIdade1" style="display:none;">
        <label id="labelIdade1">üéÇ Qual a sua idade?</label>
        <input id="idade1" type="number" min="18" max="99" />
      </div>
      <div class="campo" id="boxRenda1" style="display:none;">
        <label id="labelRenda1">üí∞ Qual a sua renda mensal?</label>
        <input id="renda1" oninput="formatarMoeda(this)" />
      </div>

      <!-- Comprador 2 -->
      <div class="campo" id="boxIdade2" style="display:none;">
        <label>üéÇ Idade do comprador 2</label>
        <input id="idade2" type="number" min="18" max="99" />
      </div>
      <div class="campo" id="boxRenda2" style="display:none;">
        <label>üí∞ Renda mensal do comprador 2</label>
        <input id="renda2" oninput="formatarMoeda(this)" />
      </div>

      <div class="campo" id="boxEstado" style="display:none;">
        <label>üìç Em qual estado ser√° o empreendimento?</label>
        <select id="estado" onchange="onEstadoSelecionado()">
          <option value="">Selecione...</option>
          <option>CE</option><option>SP</option><option>RJ</option><option>MG</option>
          <option>BA</option><option>PE</option><option>PR</option><option>SC</option>
          <option>RS</option><option>GO</option><option>DF</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Tipo de renda -->
  <div class="box" id="boxProf" style="display:none;">
    <h3 class="section-title">üíº Tipo de Renda e Valores p/ Entrada</h3>
    <div class="grid">
      <div class="campo" id="boxSing" style="display:none;">
        <label>Qual o seu regime de trabalho?</label>
        <select id="tipoSing" onchange="onTipoSing()">
          <option value="">Selecione...</option>
          <option value="clt3">Trabalho CLT h√° mais de 3 anos</option>
          <option value="cltmenos">Trabalho CLT h√° menos de 3 anos</option>
          <option value="pj">Sou PJ / Aut√¥nomo</option>
        </select>
      </div>
      <div class="campo" id="boxFgts" style="display:none;">
        <label>üí∞ Possui FGTS e pretende usar?</label>
        <select id="usaFgts" onchange="toggleFgts()">
          <option value="">Selecione...</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
      </div>
      <div class="campo" id="boxFgtsVal" style="display:none;">
        <label>üí∞ Valor estimado do FGTS</label>
        <input id="fgtsVal" oninput="formatarMoeda(this)" />
      </div>
      <div class="campo" id="boxCap" style="display:none;">
        <label>Possui algum valor guardado para entrada?</label>
        <select id="temGuardado" onchange="mostrarValorGuardado()">
          <option value="">Selecione...</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
      </div>
      <div class="campo" id="boxGuardado" style="display:none;">
        <label>üí∏ Valor guardado</label>
        <input id="valorGuardado" oninput="formatarMoeda(this)" />
      </div>
    </div>
  </div>

  <div id="boxAcao" style="display:none;text-align:center;">
    <button class="btn" id="btnDiagnostico">Gerar Diagn√≥stico</button>
    <button class="btn btn-danger" onclick="limparTudo()">üßπ Limpar Valores</button>
  </div>

  <!-- Diagn√≥stico -->
  <div id="diagnosticoContainer">
    <h3>üìò Diagn√≥stico Financeiro</h3>
    <div id="diagnosticoConteudo"></div>
  </div>

  <!-- Estimativa -->
  <div id="estimativaContainer" style="display:none;">
    <h3>üí∞ Estimativa de Entrada</h3>
    <div style="text-align:center;">
      <button class="btn-large" id="btnAbrirEstimativa">Calcular Estimativa de Entrada</button>
    </div>

    <div id="boxValorImovel">
      <div class="grid" style="margin-top:16px;">
        <div class="campo">
          <label>Valor do Im√≥vel (R$)</label>
          <input id="valorImovel" oninput="formatarMoeda(this)" />
        </div>
      </div>
      <div style="text-align:center;margin-top:16px;">
        <button class="btn" onclick="calcularEntrada()">Calcular</button>
      </div>
      <div id="resultadoEntrada"></div>
    </div>
  </div>
</main>

<script>
function formatarMoeda(c){let v=(c.value||"").replace(/\D/g,"");if(!v){c.value="";return;}v=(parseInt(v,10)/100).toFixed(2).replace(".",",");v=v.replace(/\B(?=(\d{3})+(?!\d))/g,".");c.value="R$ "+v;}
function limparMoeda(v){return parseFloat((v||"").replace(/[R$\.\s]/g,"").replace(",", ".")) || 0;}

function onChangeComposicao(){
  const modo=compraCom.value;const emConjunto=modo!=="sozinho";
  boxIdade1.style.display="block";boxRenda1.style.display="block";boxEstado.style.display="block";
  labelIdade1.textContent=emConjunto?"üéÇ Idade do comprador 1":"üéÇ Qual a sua idade?";
  labelRenda1.textContent=emConjunto?"üí∞ Renda mensal do comprador 1":"üí∞ Qual a sua renda mensal?";
  boxIdade2.style.display=emConjunto?"block":"none";
  boxRenda2.style.display=emConjunto?"block":"none";
}
function onEstadoSelecionado(){boxProf.style.display="block";boxSing.style.display="block";}
function onTipoSing(){if(tipoSing.value==="clt3"){boxFgts.style.display="block";}else{boxFgts.style.display="none";boxFgtsVal.style.display="none";}boxCap.style.display="block";}
function toggleFgts(){boxFgtsVal.style.display=usaFgts.value==="sim"?"block":"none";}
function mostrarValorGuardado(){if(temGuardado.value==="sim"){boxGuardado.style.display="block";}else{boxGuardado.style.display="none";}boxAcao.style.display="block";}

const tetoFaixa={"1":190000,"2":264000,"3":350000,"4":500000};
function getTaxaMCMV(renda,cotista,estado){
  const ne=["MA","PI","CE","RN","PB","PE","AL","SE","BA"];
  const regiao=ne.includes(estado)?"no_ne":"sul_se_co";
  let faixa;if(renda<=2160)faixa="1";else if(renda<=4700)faixa="2";else if(renda<=8600)faixa="3";else faixa="4";
  const tabela={"1":{no_ne:{cot:4.07,nao:4.59},sul_se_co:{cot:4.33,nao:4.85}},"2":{no_ne:{cot:6.69,nao:7.23},sul_se_co:{cot:6.69,nao:7.23}},"3":{no_ne:{cot:7.93,nao:8.46},sul_se_co:{cot:7.93,nao:8.46}},"4":{no_ne:{cot:11.03,nao:11.03},sul_se_co:{cot:11.03,nao:11.03}}};
  const taxa=tabela[faixa][regiao][cotista?"cot":"nao"];
  return {faixa,taxa};
}

let faixaAtual=null,taxaAtual=null,rendaAtual=null;
document.getElementById("btnDiagnostico").addEventListener("click",()=>{
  const r1=limparMoeda(renda1.value);const r2=limparMoeda(renda2.value);
  const rendaTotal=r1+r2;const estadoV=estado.value;
  const cotista=tipoSing.value==="clt3";const {faixa,taxa}=getTaxaMCMV(rendaTotal,cotista,estadoV);
  faixaAtual=faixa;taxaAtual=taxa;rendaAtual=rendaTotal;
  const valorMax=tetoFaixa[faixa];
  diagnosticoConteudo.innerHTML=`<div class='card-blue'><span>Faixa do MCMV</span><strong>Faixa ${faixa}</strong></div><div class='card-blue'><span>Valor M√°ximo do Im√≥vel a ser Financiado</span><strong>R$ ${valorMax.toLocaleString("pt-BR",{minimumFractionDigits:2})}</strong></div><div class='card-blue'><span>Taxa de Juros</span><strong>${taxa.toFixed(2)}% a.a.</strong></div>`;
  diagnosticoContainer.style.display="block";estimativaContainer.style.display="block";
});

document.getElementById("btnAbrirEstimativa").addEventListener("click",()=>{document.getElementById("boxValorImovel").style.display="block";});

function calcularEntrada(){
  const valorImovelVal=limparMoeda(document.getElementById("valorImovel").value);
  const fgts=limparMoeda(fgtsVal.value);const guardado=limparMoeda(valorGuardado.value);
  const entradaTotal=valorImovelVal*0.2;const disponivel=fgts+guardado;const faltante=Math.max(0,entradaTotal-disponivel);
  const parcelaMax=rendaAtual*0.3;const i=taxaAtual/12/100;const n=420;
  const vmax=(parcelaMax*(1-Math.pow(1+i,-n)))/i;const valorFinanciavel=Math.min(vmax,tetoFaixa[faixaAtual]);
  const cenarios=[12,18,30];let html=`<p><strong>Capacidade estimada de financiamento:</strong> R$ ${valorFinanciavel.toLocaleString('pt-BR',{minimumFractionDigits:2})}</p>`;
  html+=`<table class='result-table'><tr><th>Cen√°rio</th><th>Meses</th><th>Parcela Mensal</th><th>FGTS+Guardado</th><th>Entrada Total</th><th>A Completar</th></tr>`;
  cenarios.forEach((m,i)=>{const mensal=faltante/m;html+=`<tr><td>${i+1}</td><td>${m}</td><td>R$ ${mensal.toLocaleString('pt-BR',{minimumFractionDigits:2})}</td><td>R$ ${disponivel.toLocaleString('pt-BR',{minimumFractionDigits:2})}</td><td>R$ ${entradaTotal.toLocaleString('pt-BR',{minimumFractionDigits:2})}</td><td><strong>R$ ${faltante.toLocaleString('pt-BR',{minimumFractionDigits:2})}</strong></td></tr>`;});
  html+="</table>";resultadoEntrada.innerHTML=html;
}

function limparTudo(){
  document.querySelectorAll("input, select").forEach(el=>el.value="");
  document.querySelectorAll("#boxIdade1,#boxIdade2,#boxRenda1,#boxRenda2,#boxEstado,#boxProf,#boxSing,#boxFgts,#boxFgtsVal,#boxCap,#boxGuardado,#boxAcao,#diagnosticoContainer,#estimativaContainer,#boxValorImovel")
  .forEach(e=>e.style.display="none");
  diagnosticoConteudo.innerHTML="";resultadoEntrada.innerHTML="";
  window.scrollTo({top:0,behavior:"smooth"});
}
</script>
</body>
</html>
