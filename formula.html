<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador MCMV — Financiamento Máximo</title>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 24px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    h1 {
      font-size: 22px;
      margin-bottom: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
    }

    label {
      font-size: 12px;
      color: #555;
      margin-bottom: 6px;
      display: block;
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    .buttons {
      margin-top: 16px;
      display: flex;
      gap: 10px;
    }

    button {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    button.primary {
      background: #111;
      color: #fff;
    }

    button.secondary {
      background: #eaeaea;
    }

    .result {
      margin-top: 24px;
      background: #fafafa;
      border-radius: 10px;
      padding: 16px;
      border: 1px solid #eee;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .card {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 12px;
    }

    .card strong {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .note {
      margin-top: 12px;
      font-size: 12px;
      color: #666;
      line-height: 1.4;
    }

    @media (max-width: 720px) {
      .grid, .result-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Simulador Minha Casa Minha Vida — Financiamento Máximo</h1>

    <div class="grid">
      <div>
        <label>Renda familiar (R$)</label>
        <input id="renda" value="6496,27">
      </div>

      <div>
        <label>Juros efetivos ao ano (%)</label>
        <input id="juros" value="7,9348">
      </div>

      <div>
        <label>Prazo (meses)</label>
        <input id="prazo" type="number" value="420">
      </div>

      <div>
        <label>Valor do imóvel (R$)</label>
        <input id="imovel" value="300000">
      </div>

      <div>
        <label>Idade média dos compradores</label>
        <input id="idade" type="number" value="28">
      </div>

      <div>
        <label>Comprometimento da renda (%)</label>
        <input id="comprometimento" value="30">
      </div>
    </div>

    <div class="buttons">
      <button class="primary" onclick="calcular()">Calcular</button>
      <button class="secondary" onclick="limpar()">Limpar</button>
    </div>

    <div class="result" id="resultado"></div>
  </div>

<script>
  function parseBR(valor) {
    return Number(
      String(valor)
        .replace(/\./g, "")
        .replace(",", ".")
    );
  }

  function money(valor) {
    return valor.toLocaleString("pt-BR", {
      style: "currency",
      currency: "BRL"
    });
  }

  function estimateInsurance(pmtTotal, idade) {
    let rate = 0.03;

    if (idade <= 30) rate = 0.028;
    else if (idade <= 40) rate = 0.03;
    else if (idade <= 50) rate = 0.035;
    else rate = 0.04;

    return pmtTotal * rate;
  }

  function pvPrice(pmt, i, n) {
    return pmt * (1 - Math.pow(1 + i, -n)) / i;
  }

  function calcular() {
    const renda = parseBR(document.getElementById("renda").value);
    const jurosAA = parseBR(document.getElementById("juros").value) / 100;
    const prazo = Number(document.getElementById("prazo").value);
    const valorImovel = parseBR(document.getElementById("imovel").value);
    const idade = Number(document.getElementById("idade").value);
    const comprometimento = parseBR(document.getElementById("comprometimento").value) / 100;

    const TAXA_ADM = 25;
    const LTV = 0.80;

    const pmtTotal = renda * comprometimento;
    const seguros = estimateInsurance(pmtTotal, idade);
    const pmtAJ = pmtTotal - TAXA_ADM - seguros;

    const i = jurosAA / 12;

    const capacidadeFinanceira = pvPrice(pmtAJ, i, prazo);
    const tetoLTV = valorImovel * LTV;

    const financiamento = Math.min(capacidadeFinanceira, tetoLTV);
    const entrada = valorImovel - financiamento;

    const limitante =
      financiamento === tetoLTV
        ? "Limitante: percentual máximo financiável do imóvel (LTV 80%)"
        : "Limitante: capacidade de pagamento pela renda";

    document.getElementById("resultado").innerHTML = `
      <div class="result-grid">
        <div class="card"><strong>Parcela máxima</strong>${money(pmtTotal)}</div>
        <div class="card"><strong>Parcela (Amortização + Juros)</strong>${money(pmtAJ)}</div>
        <div class="card"><strong>Capacidade financeira</strong>${money(capacidadeFinanceira)}</div>
        <div class="card"><strong>Teto por LTV (80%)</strong>${money(tetoLTV)}</div>
        <div class="card"><strong>Financiamento aprovado</strong>${money(financiamento)}</div>
        <div class="card"><strong>Entrada necessária</strong>${money(entrada)}</div>
      </div>
      <div class="note">
        ${limitante}<br>
        Modelo baseado em: parcela limitada por renda, seguros estimados por idade,
        taxa administrativa fixa e sistema PRICE (FGTS / MCMV).
      </div>
    `;
  }

  function limpar() {
    document.getElementById("resultado").innerHTML = "";
  }

  calcular();
</script>

</body>
</html>
